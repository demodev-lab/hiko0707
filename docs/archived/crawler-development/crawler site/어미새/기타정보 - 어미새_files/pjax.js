!new function(g,q,m,D){var f;(function(b){b=b.DEF||(b.DEF={});b.NAME="pjax";b.NAMESPACE=jQuery})(f||(f={}));(function(b){var e=b.State||(b.State={});e[e.blank=0]="blank";e[e.initiate=1]="initiate";e[e.open=2]="open";e[e.pause=3]="pause";e[e.lock=4]="lock";e[e.seal=5]="seal";e[e.error=6]="error";e[e.crash=7]="crash";e[e.terminate=8]="terminate";e[e.close=9]="close";b.EVENT={PJAX:b.DEF.NAME.toLowerCase(),CLICK:"click",SUBMIT:"submit",POPSTATE:"popstate",SCROLL:"scroll"}})(f||(f={}));(function(b){b.MODEL||
(b.MODEL={})})(f||(f={}));(function(b){b=b.MODEL||(b.MODEL={});b.APP||(b.APP={})})(f||(f={}));(function(b){b=b.MODEL||(b.MODEL={});b=b.APP||(b.APP={});b.DATA||(b.DATA={})})(f||(f={}));(function(b){function e(b,d){if(!Object.freeze||b===b.window||"ownerDocument"in b)return b;!Object.isFrozen(b)&&Object.freeze(b);if(!d)return b;for(var a in b){var c=b[a];~"object,function".indexOf(typeof c)&&c&&e(c,d)}return b}function g(b,d){if(!Object.seal||b===b.window||"ownerDocument"in b)return b;!Object.isSealed(b)&&
Object.seal(b);if(!d)return b;for(var a in b){var c=b[a];~"object,function".indexOf(typeof c)&&c&&g(c,d)}return b}b.MIXIN=function(b,d){var a=b.prototype;d=d.reverse();for(var c=d.length;c--;){var h=d[c].prototype,r;for(r in h)"constructor"!==r&&a[r]&&h.hasOwnProperty(r)&&(a[r]=h[r])}};b.UUID=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(b){var d=16*Math.random()|0;return("x"==b?d:d&3|8).toString(16).toUpperCase()})};b.FREEZE=e;b.SEAL=g})(f||(f={}));(function(b){})(f||
(f={}));(function(b){(function(e){var g=function(){function e(d){this.NAME=b.DEF.NAME;this.NAMESPACE=b.DEF.NAMESPACE;this.UUID=b.UUID();this.state_=b.State.blank;this.state_=d}e.prototype.MAIN=function(d){for(var a=[],c=1;c<arguments.length;c++)a[c-1]=arguments[c];return this.main_.apply(this,[d].concat(a))};e.prototype.main_=function(d){for(var a=1;a<arguments.length;a++);return d};return e}();e.Template=g})(b.MODEL||(b.MODEL={}))})(f||(f={}));(function(b){(function(e){var g=function(){return function(e){this.UUID=
b.UUID();this.state_=b.State.blank;this.state_=e}}();e.Template=g})(b.VIEW||(b.VIEW={}))})(f||(f={}));var v=this&&this.__extends||function(b,e){function g(){this.constructor=b}for(var A in e)e.hasOwnProperty(A)&&(b[A]=e[A]);b.prototype=null===e?Object.create(e):(g.prototype=e.prototype,new g)};(function(b){(function(e){var u=function(e){function d(a,c,h,r){var d=this;e.call(this,b.State.initiate);this.model_=a;this.controller_=c;this.context_=h;this.handlers={click:function(){for(var c=[],a=0;a<arguments.length;a++)c[a-
0]=arguments[a];d.controller_.click(c)},submit:function(){for(var c=[],a=0;a<arguments.length;a++)c[a-0]=arguments[a];d.controller_.submit(c)},popstate:function(){for(var c=[],a=0;a<arguments.length;a++)c[a-0]=arguments[a];d.controller_.popstate(c)},scroll:function(){for(var c=[],a=0;a<arguments.length;a++)c[a-0]=arguments[a];d.controller_.scroll(c)}};b.FREEZE(this);this.observe_(r)}v(d,e);d.prototype.observe_=function(a){this.release_(a);a.link&&this.context_.delegate(a.link,a.nss.event.click,this.handlers.click);
a.form&&this.context_.delegate(a.form,a.nss.event.submit,this.handlers.submit);jQuery(g).bind(a.nss.event.popstate,this.handlers.popstate);a.database.active&&a.fix.scroll&&jQuery(g).bind(a.nss.event.scroll,this.handlers.scroll);return this};d.prototype.release_=function(a){a.link&&this.context_.undelegate(a.link,a.nss.event.click);a.form&&this.context_.undelegate(a.form,a.nss.event.submit);jQuery(g).unbind(a.nss.event.popstate);a.database.active&&a.fix.scroll&&jQuery(g).unbind(a.nss.event.scroll);
return this};return d}(e.Template);e.Main=u})(b.VIEW||(b.VIEW={}))})(f||(f={}));(function(b){b.View=b.VIEW.Main})(f||(f={}));(function(b){(function(e){var u=function(){function e(){b.FREEZE(this)}e.prototype.enable=function(){b.Model.singleton().enable();return this};e.prototype.disable=function(){b.Model.singleton().disable();return this};e.prototype.click=function(d,a){var c;switch(typeof d){case "undefined":c=jQuery(this).filter("a").first().clone();break;case "object":c=jQuery(d).clone();break;
case "string":a=jQuery.extend(!0,{},a,{href:d});c=jQuery("<a/>",a);break;default:return this}var h=b.Model.singleton().configure(c[0]);h&&c.first().one(h.nss.event.click,function(){for(var c=[],a=0;a<arguments.length;a++)c[a-0]=arguments[a];return b.Controller.singleton().click(c)}).click();return this};e.prototype.submit=function(d,a,c){var h=q.createDocumentFragment(),r;switch(typeof d){case "undefined":a=jQuery(this).filter("form").first().clone();break;case "object":a=jQuery(d).clone();break;
case "string":a=jQuery.extend(!0,{},a,{action:d});d=c instanceof Array&&Array||c instanceof Object&&Object||m;for(var n in c){switch(d){case Object:if(!Object.prototype.hasOwnProperty.call(c,n))continue;r=jQuery("<textarea/>",{name:n}).val(c[n]);break;case Array:c[n].attrs=c[n].attrs||{};c[n].attrs.name=c[n].name||c[n].attrs.name;c[n].attrs.type=c[n].type||c[n].attrs.type;r=jQuery("<"+c[n].tag+"/>",c[n].attrs).val(c[n].value);break;default:continue}h.appendChild(r[0])}a=jQuery("<form/>",a).append(h);
break;default:return this}(c=b.Model.singleton().configure(a[0]))&&a.first().one(c.nss.event.submit,function(){for(var c=[],a=0;a<arguments.length;a++)c[a-0]=arguments[a];return b.Controller.singleton().submit(c)}).submit();return this};e.prototype.getCache=function(d){void 0===d&&(d=g.location.href);(d=b.Model.singleton().getCache(d))&&(d={data:d.data,textStatus:d.textStatus,jqXHR:d.jqXHR,expires:d.expires});return d};e.prototype.setCache=function(d,a,c,h){void 0===d&&(d=g.location.href);switch(arguments.length){case 0:return this.setCache(d,
q.documentElement.outerHTML);case 1:return this.setCache(d,null);default:b.Model.singleton().setCache(d,a,c,h)}return this};e.prototype.removeCache=function(d){void 0===d&&(d=g.location.href);b.Model.singleton().removeCache(d);return this};e.prototype.clearCache=function(){b.Model.singleton().clearCache();return this};e.prototype.follow=function(d,a,c,h){if(!b.Model.singleton().isDeferrable)return!1;var r=d.currentTarget;a.follow=!0;a.host=c||"";isFinite(d.timeStamp)&&(a.timeStamp=h||d.timeStamp);
b.Model.singleton().setPageXHR(a);jQuery.when(a).done(function(){!b.Model.singleton().getCache(r.href)&&b.Model.singleton().isOperatable(d)&&b.Model.singleton().setCache(r.href,m,m,a)});jQuery[b.DEF.NAME].click(r.href);return!0};e.prototype.bypass=function(){return b.Model.singleton().bypass()};e.prototype.host=function(){return b.Model.singleton().host()};return e}();e.Functions=u})(b.CONTROLLER||(b.CONTROLLER={}))})(f||(f={}));(function(b){(function(e){var g=function(){return function(){b.FREEZE(this)}}();
e.Methods=g})(b.CONTROLLER||(b.CONTROLLER={}))})(f||(f={}));(function(b){(function(e){var f=function(){function e(d,a){this.UUID=b.UUID();this.state_=b.State.blank;this.PROPERTIES=[];this.state_=a}e.prototype.EXTEND=function(d){d instanceof b.DEF.NAMESPACE?(d instanceof jQuery&&(d=d.add()),this.REGISTER_FUNCTION(d),this.REGISTER_METHOD(d)):(d!==this.EXTENSION&&(d=this.EXTENSION),this.REGISTER_FUNCTION(d));this.UPDATE_PROPERTIES(d);return d};e.prototype.REGISTER=function(d){var a=this;this.EXTENSION=
this.EXTENSION||function(){for(var c=[],h=0;h<arguments.length;h++)c[h-0]=arguments[h];c=[a.EXTEND(this)].concat(c);c=a.EXEC.apply(a,c);return c instanceof Array?d.MAIN.apply(d,c):c};this.EXTEND(this.EXTENSION);g[b.DEF.NAMESPACE]=g[b.DEF.NAMESPACE]||{};b.DEF.NAMESPACE[b.DEF.NAME]=b.DEF.NAMESPACE.prototype?b.DEF.NAMESPACE.prototype[b.DEF.NAME]=this.EXTENSION:this.EXTENSION};e.prototype.EXEC=function(){return this.exec_.apply(this,arguments)};e.prototype.exec_=function(d){for(var a=[],c=1;c<arguments.length;c++)a[c-
1]=arguments[c];return[d].concat(a)};e.prototype.REGISTER_FUNCTION=function(d){var a=this.FUNCTIONS,c;for(c in a)"constructor"!==c&&(d[c]=a[c]);return d};e.prototype.REGISTER_METHOD=function(d){var a=this.METHODS,c;for(c in a)"constructor"!==c&&(d[c]=a[c]);return d};e.prototype.UPDATE_PROPERTIES=function(d){var a=this.PROPERTIES,c,h,r;c=0;for(h=a.length;c<h;c++)"constructor"!==c&&(r=a[c],d[r]&&(d[r]=d[r]()));return d};return e}();e.Template=f})(b.CONTROLLER||(b.CONTROLLER={}))})(f||(f={}));(function(b){(function(e){var g=
function(d){function a(c){d.call(this,c,b.State.initiate);this.model_=c;this.FUNCTIONS=new e.Functions;this.METHODS=new e.Methods;this.REGISTER(c);b.FREEZE(this)}v(a,d);a.prototype.exec_=function(c){var a=[].slice.call(arguments,1,2);switch(typeof a[0]){case "undefined":case "object":break;default:return c}return[c].concat(a)};a.prototype.view=function(c,a){return new b.View(this.model_,this,c,a)};a.prototype.click=function(c){this.model_.click.apply(this.model_,c)};a.prototype.submit=function(c){this.model_.submit.apply(this.model_,
c)};a.prototype.popstate=function(c){this.model_.popstate.apply(this.model_,c)};a.prototype.scroll=function(c){this.model_.scroll.apply(this.model_,c)};return a}(e.Template);e.Main=g;var f=function(){function d(a){void 0===a&&(a=b.Model.singleton());d.instance_=d.instance_||new g(a)}d.singleton=function(){return d.instance_};d.prototype.singleton=function(){return d.singleton()};return d}();e.Singleton=f})(b.CONTROLLER||(b.CONTROLLER={}))})(f||(f={}));(function(b){b.Controller=b.CONTROLLER.Singleton})(f||
(f={}));(function(b){(function(b){var f=function(){function b(d,a){void 0===d&&(d=1);void 0===a&&(a=0);this.list_=[];this.config_={mode:1,size:0};this.table_={};this.option_={};this.config_.mode=d||this.config_.mode;this.config_.size=a||this.config_.size}b.prototype.define=function(d,a,c){void 0===a&&(a=this.config_.mode);void 0===c&&(c=this.config_.size);this.option_[d]={mode:a,size:c};this.table_[d]=[]};b.prototype.reserve=function(d,a){switch(typeof d){case "string":!this.option_[d]&&this.define(d);
var c=this.option_[d],h=this.table_[d],r=[].slice.call(arguments,2);break;case "function":a=d;d=m;c=this.config_;h=this.list_;r=[].slice.call(arguments,1);break;default:return}if("function"===typeof a)h[0<c.mode?"push":"unshift"]([a,r.shift(),r])};b.prototype.digest=function(d,a){switch(typeof d){case "string":!this.option_[d]&&this.define(d);a=a||0;var c=this.option_[d],h=this.table_[d];if(!h)return;break;case "number":case "undefined":a=d||0;d=m;c=this.config_;h=this.list_;break;default:return}h.length>
c.size&&c.size&&(0<c.mode?h.splice(0,h.length-c.size):h.splice(h.length-c.size,h.length));for(a=a||-1;c=a--&&h.pop();)c.shift().apply(c.shift()||g,c.shift()||[]);if(m===d){var h=this.table_,r;for(r in h)this.digest(r,a)}};b.prototype.clear=function(d){switch(typeof d){case "string":!this.option_[d]&&this.define(d);this.table_[d].splice(0,this.table_[d].length);break;default:d=this.table_;for(var a in d)this.clear(a)}};return b}();b.Task=f})(b.LIBRARY||(b.LIBRARY={}))})(f||(f={}));(function(b){(function(b){(function(b){(function(b){(function(d){(function(a){var c=
function(){function c(a){this.task_=a;this.labels_={done:"done",fail:"fail",always:"always"}}c.prototype.done=function(c){this.task_.reserve(this.labels_.done,c);return this};c.prototype.fail=function(c){this.task_.reserve(this.labels_.fail,c);return this};c.prototype.always=function(c){this.task_.reserve(this.labels_.always,c);return this};c.prototype.resolve=function(){this.task_.clear(this.labels_.fail);this.task_.digest(this.labels_.done);this.task_.digest(this.labels_.always);return this};c.prototype.reject=
function(){this.task_.clear(this.labels_.done);this.task_.digest(this.labels_.fail);this.task_.digest(this.labels_.always);return this};return c}();a.Task=c;var h=function(c){function a(){c.apply(this,arguments)}v(a,c);return a}(c);a.TaskUp=h;c=function(c){function a(){c.apply(this,arguments)}v(a,c);a.prototype.done=function(c){return this};a.prototype.fail=function(c){return this};a.prototype.always=function(c){return this};a.prototype.resolve=function(){return this};return a}(c);a.TaskDown=c})(d.STATEFUL||
(d.STATEFUL={}))})(b.DB||(b.DB={}))})(b.DATA||(b.DATA={}))})(b.APP||(b.APP={}))})(b.MODEL||(b.MODEL={}))})(f||(f={}));(function(b){(function(e){(function(e){(function(e){(function(d){var a=function(){function c(c,a,d){var l=this;this.origin_=c;this.connect_=a;this.extend_=d;this.state_=function(){return l.origin_.state()};this.task_=new b.LIBRARY.Task;this.cache_={stateful:{}}}c.prototype.stateful_=function(){var c=this,a=function(a,r){return c.cache_.stateful[c.state_()]=c.cache_.stateful[c.state_()]||
new a(c.origin_,c.connect_,c.extend_,c.task_,r)};switch(this.state_()){case b.State.blank:return a(d.STATE.Blank,!0);case b.State.initiate:return a(d.STATE.Initiate,!0);case b.State.open:return a(d.STATE.Open,!0);case b.State.close:return a(d.STATE.Close,!0);case b.State.terminate:return a(d.STATE.Terminate,!0);case b.State.error:return a(d.STATE.Error,!1);default:return a(d.STATE.Except,!1)}};c.prototype.open=function(){return this.stateful_().open()};c.prototype.resolve=function(){return this.stateful_().resolve()};
c.prototype.reject=function(){return this.stateful_().reject()};return c}();d.Stateful=a})(e.DB||(e.DB={}))})(e.DATA||(e.DATA={}))})(e.APP||(e.APP={}))})(b.MODEL||(b.MODEL={}))})(f||(f={}));(function(b){(function(b){(function(b){(function(b){(function(d){(function(a){var c=function(){function c(a,h,r,b,e){this.origin=a;this.connect=h;this.extend=r;this.task=e?new d.STATEFUL.TaskUp(b):new d.STATEFUL.TaskDown(b)}c.prototype.open=function(){return this.task};c.prototype.resolve=function(){};c.prototype.reject=
function(){this.task.reject()};return c}();a.Default=c;var h=function(c){function a(){c.apply(this,arguments)}v(a,c);a.prototype.open=function(){this.connect();return this.task};a.prototype.resolve=function(){this.open()};a.prototype.reject=function(){this.task.reject()};return a}(c);a.Blank=h;h=function(c){function a(){c.apply(this,arguments)}v(a,c);a.prototype.open=function(){return this.task};a.prototype.resolve=function(){};a.prototype.reject=function(){this.task.reject()};return a}(c);a.Initiate=
h;h=function(c){function a(){c.apply(this,arguments)}v(a,c);a.prototype.open=function(){var c=this;this.extend();setTimeout(function(){return c.origin.resolve()},1);return this.task};a.prototype.resolve=function(){this.task.resolve()};a.prototype.reject=function(){this.task.reject()};return a}(c);a.Open=h;h=function(c){function a(){c.apply(this,arguments)}v(a,c);a.prototype.open=function(){this.connect();return this.task};a.prototype.resolve=function(){this.open()};a.prototype.reject=function(){this.task.reject()};
return a}(c);a.Close=h;h=function(c){function a(){c.apply(this,arguments)}v(a,c);return a}(c);a.Terminate=h;h=function(c){function a(){c.apply(this,arguments)}v(a,c);return a}(c);a.Error=h;c=function(c){function a(){c.apply(this,arguments)}v(a,c);return a}(c);a.Except=c})(d.STATE||(d.STATE={}))})(b.DB||(b.DB={}))})(b.DATA||(b.DATA={}))})(b.APP||(b.APP={}))})(b.MODEL||(b.MODEL={}))})(f||(f={}));(function(b){(function(b){(function(b){(function(b){var d=function(){function a(c){this.DB=c;this.autoIncrement=
!1;this.indexes=[];this.size=100;this.buffer={};this.diff={}}a.prototype.accessStore=function(c,a){var r=this;void 0===a&&(a="readwrite");try{var b=this.DB.database(),d=b&&b.transaction(this.name,a).objectStore(this.name)}catch(k){}d?c(d):this.DB.open().done(function(){return r.accessStore(c)})};a.prototype.accessCount=function(){var c="string"===typeof arguments[0]&&arguments[0],a=arguments[c?1:0];this.accessStore(function(b){(c?b.index(c).count():b.count()).onsuccess=function(){a.apply(this,[].slice.call(arguments,
1).concat(this.result))}})};a.prototype.accessRecord=function(c,a,b){this.accessStore(function(b){b.get(c).onsuccess=a},b)};a.prototype.accessCursor=function(c,a,b,d){this.accessStore(function(l){(b&&a?l.index(c).openCursor(a,b):a?l.index(c).openCursor(a):l.openCursor()).onsuccess=d})};a.prototype.accessAll=function(c,a,b,d){"function"===typeof c&&(d=c,b=a=c=null);this.accessCursor(c,a,b,d)};a.prototype.get=function(a,h){var b=this;this.accessRecord(a,function(a){b.setBuffer(a.target.result);h(a)})};
a.prototype.set=function(a,h){var b=this;a=jQuery.extend(!0,{},a);this.setBuffer(a,h);this.accessRecord(a[this.keyPath],function(d){d.target.source.put(h?jQuery.extend(!0,{},d.target.result,a):a);b.autoIncrement||delete b.diff[a[b.keyPath]]})};a.prototype.remove=function(a){this.removeBuffer(a);this.accessStore(function(h){h["delete"](a)})};a.prototype.clear=function(){this.clearBuffer();this.accessStore(function(a){a.clear()})};a.prototype.clean=function(){var a=this;if(this.size&&this.indexes.length){var h=
this.indexes[0].name,b=this.size;this.accessCount(h,function(d){d<=b||(b=d-b,a.accessCursor(h,a.DB.IDBKeyRange.upperBound(Infinity),"next",function(h){h.target.result&&b--&&(h=h.target.result,delete a.diff[h.primaryKey],h["delete"](),h["continue"]())}))})}};a.prototype.loadBuffer=function(a){function h(){if(!this.result)return a&&a();var h=this.result;b[h.primaryKey]=h.value;h["continue"]()}if(!this.autoIncrement){var b=this.buffer;this.indexes.length?this.DB.IDBKeyRange&&this.accessAll(this.indexes[0].name,
this.DB.IDBKeyRange.upperBound(Infinity),"prev",h):this.accessAll(h)}};a.prototype.saveBuffer=function(a){var h=this;this.autoIncrement||this.accessStore(function(b){for(var d in h.diff)b.put(h.diff[d]);a&&a()})};a.prototype.getBuffers=function(){return this.buffer};a.prototype.setBuffers=function(a,h){for(var b in a)this.setBuffer(a[b],h);return this.buffer};a.prototype.getBuffer=function(a){if(!this.autoIncrement)return this.buffer[a]};a.prototype.setBuffer=function(a,h){if(!this.autoIncrement){if(!a)return a;
var b=a[this.keyPath];this.buffer[b]=h?jQuery.extend(!0,{},this.buffer[b],a):a;this.diff[b]=this.buffer[b];return this.buffer[b]}};a.prototype.removeBuffer=function(a){if(!this.autoIncrement){var h=this.buffer[a];delete this.buffer[a];delete this.diff[a];return h}};a.prototype.clearBuffer=function(){if(!this.autoIncrement){for(var a in this.buffer)delete this.buffer[a];for(a in this.diff)delete this.diff[a]}};return a}();b.Store=d})(b.DATA||(b.DATA={}))})(b.APP||(b.APP={}))})(b.MODEL||(b.MODEL={}))})(f||
(f={}));(function(b){(function(b){(function(b){(function(b){(function(d){var a=function(a){function h(){a.apply(this,arguments);this.name="meta";this.keyPath="key";this.autoIncrement=!1;this.size=0}v(h,a);return h}(b.Store);d.Meta=a})(b.STORE||(b.STORE={}))})(b.DATA||(b.DATA={}))})(b.APP||(b.APP={}))})(b.MODEL||(b.MODEL={}))})(f||(f={}));(function(b){(function(b){(function(b){(function(b){(function(d){var a=function(a){function h(){a.apply(this,arguments);this.name="history";this.keyPath="url";this.autoIncrement=
!1;this.indexes=[{name:"date",keyPath:"date",option:{unique:!1}}];this.size=300}v(h,a);return h}(b.Store);d.History=a})(b.STORE||(b.STORE={}))})(b.DATA||(b.DATA={}))})(b.APP||(b.APP={}))})(b.MODEL||(b.MODEL={}))})(f||(f={}));(function(b){(function(b){(function(b){(function(b){(function(d){var a=function(a){function h(){a.apply(this,arguments);this.name="server";this.keyPath="host";this.autoIncrement=!1;this.indexes=[{name:"score",keyPath:"score",option:{unique:!1}}];this.size=100}v(h,a);return h}(b.Store);
d.Server=a})(b.STORE||(b.STORE={}))})(b.DATA||(b.DATA={}))})(b.APP||(b.APP={}))})(b.MODEL||(b.MODEL={}))})(f||(f={}));(function(b){(function(e){(function(e){(function(e){var d=function(){function a(){var a=this;this.IDBFactory=g.indexedDB||g.webkitIndexedDB||g.mozIndexedDB||g.msIndexedDB;this.IDBKeyRange=g.IDBKeyRange||g.webkitIDBKeyRange||g.mozIDBKeyRange||g.msIDBKeyRange;this.name=b.DEF.NAME;this.refresh=this.version=10;this.revision=this.upgrade=0;this.state_=b.State.blank;this.stateful=new e.DB.Stateful(this,
function(){return a.connect()},function(){return a.extend()});this.age=1E4;this.timer=this.expires=0;this.stores={meta:new e.STORE.Meta(this),history:new e.STORE.History(this),server:new e.STORE.Server(this)};this.meta={version:{key:"version",value:m},update:{key:"update",value:m},revision:{key:"revision",value:m}}}a.prototype.state=function(){return this.state_};a.prototype.extend=function(){var a=this;this.expires=(new Date).getTime()+this.age;clearTimeout(this.timer);this.timer=setTimeout(function(){return a.check()},
this.age)};a.prototype.check=function(){!this.age||(new Date).getTime()<=this.expires||b.State.open===this.state()&&this.close()};a.prototype.database=function(){this.extend();return this.database_};a.prototype.configure=function(a,h){this.revision=a;this.refresh=h};a.prototype.up=function(){this.state_=b.State.blank;this.open()};a.prototype.down=function(){this.reject();this.close();this.state_=b.State.error};a.prototype.open=function(){!this.IDBFactory&&this.down();return this.stateful.open()};
a.prototype.close=function(){this.database_&&this.database_.close&&this.database_.close();this.state_=b.State.close};a.prototype.resolve=function(){this.stateful.resolve()};a.prototype.reject=function(){this.stateful.reject()};a.prototype.connect=function(){this.create()};a.prototype.create=function(){var a=this;try{this.close();this.state_=b.State.initiate;var h=this.IDBFactory.open(this.name,this.upgrade?this.version:1),d=function(){a.verify(function(){a.state_=b.State.open;a.resolve();a.extend()})};
if("done"===h.readyState)this.database_=h.result,this.database()?d():this.format();else{var n=setTimeout(function(){return a.down()},3E3);h.onblocked=function(){clearTimeout(n);a.database_=h.result;a.close();setTimeout(function(){return a.open()},1E3)};h.onupgradeneeded=function(){clearTimeout(n);a.database_=h.result;a.createStores()};h.onsuccess=function(){clearTimeout(n);a.database_=h.result;d()};h.onerror=function(){clearTimeout(n);a.database_=h.result;a.down()}}}catch(l){this.down()}};a.prototype.destroy=
function(a,h){var d=this;try{this.close();this.state_=b.State.terminate;var n=this.IDBFactory.deleteDatabase(this.name);n&&(n.onsuccess=a,n.onerror=h);setTimeout(function(){return b.State.terminate===d.state()&&d.down()},3E3)}catch(l){this.down()}};a.prototype.format=function(){var a=this;this.destroy(function(){return a.up()},function(){return a.down()})};a.prototype.verify=function(a){var h=this,b=this.database(),d=this.version,l=this.revision,k=this.meta,y=this.stores.meta;if(b.objectStoreNames.length!==
Object.keys(this.stores).length)return void h.format();for(var e in this.stores){var g=b.transaction(this.stores[e].name,"readonly").objectStore(this.stores[e].name);switch(!1){case g.keyPath===this.stores[e].keyPath:case g.indexNames.length===this.stores[e].indexes.length:return void h.format()}}var f=!1;y.get(k.version.key,function(a){f||(a=a.target.result,!a||h.upgrade?y.set(y.setBuffer({key:k.version.key,value:d})):a.value>d?(f=!0,h.down()):a.value<d&&(f=!0,h.format()))});y.get(k.revision.key,
function(a){f||((a=a.target.result,a)?a.value>l?(f=!0,h.down()):a.value<l&&(f=!0,h.format()):y.set(y.setBuffer({key:k.revision.key,value:l})))});y.get(k.update.key,function(b){if(!f){b=b.target.result;var d=Math.floor((new Date).getTime()/864E5);b&&h.refresh?b.value>d?a():b.value<=d&&h.format():(y.set(y.setBuffer({key:k.update.key,value:d+h.refresh})),a())}})};a.prototype.createStores=function(){this.destroyStores();var a=this.database(),h;for(h in this.stores)for(var b=this.stores[h],d=a.createObjectStore(b.name,
{keyPath:b.keyPath,autoIncrement:b.autoIncrement}),l=0,b=b.indexes,k;k=b[l];l++)d.createIndex(k.name,k.keyPath,k.option)};a.prototype.destroyStores=function(){for(var a=this.database(),h=a.objectStoreNames?a.objectStoreNames.length:0;h--;)a.deleteObjectStore(a.objectStoreNames[h])};return a}();e.Database=d})(e.DATA||(e.DATA={}))})(e.APP||(e.APP={}))})(b.MODEL||(b.MODEL={}))})(f||(f={}));(function(b){(function(b){(function(b){(function(b){var d=function(){function a(a){this.age_=a}a.prototype.getCookie=
function(a){if(a&&g.navigator.cookieEnabled)return a=new RegExp("(?:^|; )("+encodeURIComponent(a)+"=[^;]*)"),(a=(q.cookie.match(a)||[]).pop())&&decodeURIComponent(a.split("=").pop())};a.prototype.setCookie=function(a,h,b){void 0===b&&(b={});if(a&&g.navigator.cookieEnabled)return b.age=b.age||this.age_,q.cookie=[encodeURIComponent(a)+"="+encodeURIComponent(h),b.age?"; expires="+(new Date((new Date).getTime()+1E3*b.age)).toUTCString():"",b.path?"; path="+b.path:"; path=/",b.secure?"; secure":""].join(""),
this.getCookie(a)};return a}();b.Cookie=d})(b.DATA||(b.DATA={}))})(b.APP||(b.APP={}))})(b.MODEL||(b.MODEL={}))})(f||(f={}));(function(b){(function(b){(function(b){(function(b){var d=function(){return function(){this.DB=new b.Database;this.Cookie=new b.Cookie(864E3)}}();b.Main=d})(b.DATA||(b.DATA={}))})(b.APP||(b.APP={}))})(b.MODEL||(b.MODEL={}))})(f||(f={}));(function(b){(function(b){var f=function(){function b(){}b.trim=function(b){b="string"===typeof b?b:String(0===b&&b.toString()||"");if(b.trim)b=
b.trim();else if(b=b.replace(/^[\s\uFEFF\xA0]+/,"")){var a=/[\s\uFEFF\xA0]/,c=b.length,h=c%8;a:{for(;h--;)if(!a.test(b.charAt(--c)))break a;for(;c;){if(!a.test(b.charAt(--c)))break a;if(!a.test(b.charAt(--c)))break a;if(!a.test(b.charAt(--c)))break a;if(!a.test(b.charAt(--c)))break a;if(!a.test(b.charAt(--c)))break a;if(!a.test(b.charAt(--c)))break a;if(!a.test(b.charAt(--c)))break a;if(!a.test(b.charAt(--c)))break a}}b=b.substring(0,c+1)}return b};b.repeat=function(b,a){switch(b instanceof Array&&
"array"||typeof b){case "string":return Array(a+1).join(b);case "array":var c=b.length;if(300>a){var h=Array(a);this.duff(-a,function(a){return h[a]=b[a%c]})}else{for(h=b.slice();2*h.length<=a;)h=h.concat(h);h=h.concat(h.slice(0,a-h.length))}return h}};b.fire=function(b,a,c,h){void 0===a&&(a=g);void 0===c&&(c=[]);return"function"===typeof b?h?setTimeout(function(){b.apply(a||g,c)},0):b.apply(a||g,c):b};b.duff=function(b,a){if(0>b){for(var c=-b,h=c%8;h--;)a(--c);for(;c;)a(--c),a(--c),a(--c),a(--c),
a(--c),a(--c),a(--c),a(--c)}else{for(var c=0,h=b%8,r=b/8^0;h--;)a(c++);for(;r--;)a(c++),a(c++),a(c++),a(c++),a(c++),a(c++),a(c++),a(c++)}};b.duffEx=function(b,a){if(0>b){var c=-b,h=c%8;a:{for(;h--;)if(!1===a(--c))break a;for(;c;){if(!1===a(--c))break a;if(!1===a(--c))break a;if(!1===a(--c))break a;if(!1===a(--c))break a;if(!1===a(--c))break a;if(!1===a(--c))break a;if(!1===a(--c))break a;if(!1===a(--c))break a}}}else{var c=0,h=b%8,r=b/8^0;a:{for(;h--;)if(!1===a(c++))break a;for(;r--;){if(!1===a(c++))break a;
if(!1===a(c++))break a;if(!1===a(c++))break a;if(!1===a(c++))break a;if(!1===a(c++))break a;if(!1===a(c++))break a;if(!1===a(c++))break a;if(!1===a(c++))break a}}}};b.normalizeUrl=function(b,a){void 0===a&&(a=!0);var c;c=this.trim(b);if(!/^([^:/?#]+):\/\/[^/?#.]+\.[^/?#]+/i.test(c)){var h=q.createElement("a");h.href=c;c=h.href}c=encodeURI(decodeURI(c));c=c.replace(/["`^|\\<>{}\[\]\s].*/,"");return c=a?this.justifyPercentEncodingUrlCase_(b,c):c};b.canonicalizeUrl=function(b){b=this.normalizeUrl(b,
!1);return b=b.replace(/(?:%\w{2})+/g,function(a){return a.toUpperCase()})};b.compareUrl=function(b,a){b=this.canonicalizeUrl(b);a=this.canonicalizeUrl(a);return b===a};b.justifyPercentEncodingUrlCase_=function(b,a){function c(a){var c=~b.indexOf(a.toUpperCase())||~b.indexOf(a.toLowerCase());return c?b.substr(~c,a.length):a}return b===a?a:a.replace(/(?:%\w{2})+/g,c)};return b}();b.Utility=f})(b.LIBRARY||(b.LIBRARY={}))})(f||(f={}));(function(b){(function(e){(function(e){var f=function(){function d(a){this.model_=
a;this.data_=new e.DATA.Main;this.stores_=this.data_.DB.stores;this.util_=b.LIBRARY.Utility}d.prototype.getCookie=function(a){return this.data_.Cookie.getCookie(a)};d.prototype.setCookie=function(a,c,b){return this.data_.Cookie.setCookie(a,c,b)};d.prototype.connect=function(a){a.database.active?(this.data_.DB.configure(a.database.revision,a.database.refresh),this.data_.DB.up(),this.saveTitle(),this.saveScrollPosition()):this.data_.DB.down()};d.prototype.loadBuffers=function(){for(var a in this.stores_)this.stores_[a].loadBuffer()};
d.prototype.saveBuffers=function(){for(var a in this.stores_)this.stores_[a].saveBuffer()};d.prototype.getHistoryBuffer=function(a){return this.stores_.history.getBuffer(this.model_.convertUrlToKey(a,!0))};d.prototype.loadTitle=function(){var a=this,c=this.model_.convertUrlToKey(g.location.href,!0),b=this.stores_.history.getBuffer(c);b&&"string"===typeof b.title?q.title=b.title:this.stores_.history.get(c,function(d){(b=d.target.result)&&b.title&&a.model_.compareKeyByUrl(c,a.util_.canonicalizeUrl(g.location.href))&&
(q.title=b.title)})};d.prototype.saveTitle=function(a,c){void 0===a&&(a=g.location.href);void 0===c&&(c=q.title);var b={url:this.model_.convertUrlToKey(a,!0),title:c,date:(new Date).getTime(),scrollX:m,scrollY:m,host:m,expires:m};this.stores_.history.set(b,!0);this.stores_.history.clean()};d.prototype.loadScrollPosition=function(){function a(a,c){"number"===typeof a&&"number"===typeof c&&g.scrollTo(parseInt(Number(a)+"",10),parseInt(Number(c)+"",10))}var c=this,b=this.model_.convertUrlToKey(g.location.href,
!0),d=this.stores_.history.getBuffer(b);d&&"number"===typeof d.scrollX?a(d.scrollX,d.scrollY):this.stores_.history.get(b,function(n){(d=n.target.result)&&"number"===typeof d.scrollX&&c.model_.compareKeyByUrl(b,c.util_.canonicalizeUrl(g.location.href))&&a(d.scrollX,d.scrollY)})};d.prototype.saveScrollPosition=function(a,c,b){void 0===a&&(a=g.location.href);void 0===c&&(c=jQuery(g).scrollLeft());void 0===b&&(b=jQuery(g).scrollTop());a={url:this.model_.convertUrlToKey(a,!0),scrollX:c,scrollY:b,date:(new Date).getTime(),
title:m,host:m,expires:m};this.stores_.history.set(a,!0)};d.prototype.loadExpires=function(){};d.prototype.saveExpires=function(a,c,b){a={url:this.model_.convertUrlToKey(a,!0),host:c||"",expires:b,title:m,scrollX:m,scrollY:m,date:m};this.stores_.history.set(a,!0)};d.prototype.getServerBuffers=function(){return this.stores_.server.getBuffers()};d.prototype.getServerBuffer=function(a){a=this.model_.convertUrlToKey(a,!0).split("//").pop().split("/").shift();a=this.model_.compareKeyByUrl("http://"+a,
"http://"+g.location.host)?"":a;return this.stores_.server.getBuffer(a)};d.prototype.loadServer=function(){};d.prototype.saveServer=function(a,c,b,d,n){a=a.split("//").pop().split("/").shift();a=this.model_.compareKeyByUrl("http://"+a,"http://"+g.location.host)?"":a;this.stores_.server.set({host:a,time:Math.max(b,1),score:d,state:n,expires:c},!0);this.stores_.server.clean()};d.prototype.removeServer=function(a){this.stores_.server.remove(a);this.stores_.server.clean()};return d}();e.Data=f})(e.APP||
(e.APP={}))})(b.MODEL||(b.MODEL={}))})(f||(f={}));(function(b){(function(e){(function(e){var f=function(){function d(a){this.data_=a;this.util_=b.LIBRARY.Utility;this.force_=!1;this._host="";this.parallel_=4}d.prototype.host_=function(a,c){c&&(this._host=c.balance.active?this.sanitize(a,c).split("//").pop().split("/").shift()||"":"");return this._host};d.prototype.host=function(){return this.host_()};d.prototype.sanitize=function(a,c){if(!c)return"";var b;switch(a&&typeof a){case "string":b=a;break;
case "object":b=4===a.readyState&&a.getResponseHeader(c.balance.server.header)||a.host}b=b||"";return!/[/?#"`^|\\<>{}\[\]\s]/.test(b)&&jQuery.grep(c.balance.bounds,function(a){return""===b||"*"===a||b===a||"."===a.charAt(0)&&a===b.slice(-a.length)}).length&&b||""};d.prototype.enable=function(a){if(a.balance.active&&a.balance.client.support.browser.test(g.navigator.userAgent))this.data_.setCookie(a.balance.client.cookie.balance,"1");else return void this.disable(a);a.balance.client.support.redirect.test(g.navigator.userAgent)&&
this.data_.setCookie(a.balance.client.cookie.redirect,"1")};d.prototype.disable=function(a){this.data_.getCookie(a.balance.client.cookie.balance)&&this.data_.setCookie(a.balance.client.cookie.balance,"0");this.data_.getCookie(a.balance.client.cookie.redirect)&&this.data_.setCookie(a.balance.client.cookie.redirect,"0");this.changeServer("",a)};d.prototype.score=function(a,c){return Math.max(Math.round(c/a*1E3),0)};d.prototype.changeServer=function(a,c){c.balance.active?(this.host_(a,c),this.data_.setCookie(c.balance.client.cookie.host,
a)):this.host_("",c);return this.host()};d.prototype.chooseServers_=function(a){var c=this,b=a.balance.server.respite,d=a.balance.weight,n=a.ajax.timeout,l=a.balance.client.hosts.slice(),l=this.force_?jQuery.grep(l,function(a){return!!a}):l;(function(){var b=c.data_.getCookie(a.balance.client.cookie.host);if(!c.force_||b)b===c.sanitize(b,a)?!~jQuery.inArray(b,l)&&l.unshift(b):c.data_.setCookie(a.balance.client.cookie.host,"")})();var k=this.data_.getServerBuffers(),y={};jQuery.each(Object.keys(k),
function(b,h){var d=k[h];~jQuery.inArray(d.host,l)&&l.splice(jQuery.inArray(d.host,l),1);if(!c.force_||d.host)d.host===c.sanitize(d.host,a)&&d.expires>(new Date).getTime()?y[d.score]=d:c.data_.removeServer(d.host)});var e=Object.keys(y).sort(function(a,c){return+c-+a}),g=[],f;for(jQuery.each(e,function(k){k=y[e[k]];var m=k.host,p=k.time,t=k.score,q=k.state;~jQuery.inArray(m,l)&&l.splice(jQuery.inArray(m,l),1);if(!(q+b>=(new Date).getTime())){q&&c.data_.removeServer(k.host);switch(!0){case g.length>=
a.balance.random&&0<g.length:return!1;case d&&!m&&!!Math.floor(Math.random()*d):case n&&p>=n:case g.length>=Math.min(Math.floor(e.length/2),3)&&f&&p>=f.time+500&&n&&p>=2*n/3:case g.length>=Math.min(Math.floor(e.length/2),3)&&f&&t<=f.score/2:return}f=f||k;g.push(m)}});l.length;)g.push(l.splice(Math.floor(Math.random()*l.length),1).shift());return g};d.prototype.chooseServerFromCache_=function(a){var c=this,b=[],d=this.data_.getHistoryBuffer(a.destLocation.href);switch(!0){case !d:break;case d.host!==
this.sanitize(d.host,a):this.data_.saveExpires(d.url,"",0);case !d.expires:case d.expires<(new Date).getTime():case this.force_&&!d.host:break;default:b=jQuery.map(this.data_.getServerBuffers(),function(a){if(a.host===d.host)if(a.state>=(new Date).getTime())c.data_.saveExpires(d.url,d.host,0);else return a.host})}return b.length?b.pop()||" ":""};d.prototype.chooseServerFromScore_=function(a){a=this.chooseServers_(a);return a.slice(Math.floor(Math.random()*Math.min(a.length,6))).shift()||" "};d.prototype.chooseServer=
function(a){return a.balance.active?this.util_.trim(this.chooseServerFromCache_(a)||this.chooseServerFromScore_(a)):""};d.prototype.bypass=function(a){var c=this;this.force_=!0;var b=jQuery.Deferred();if(!a||!a.balance.active)return b.reject();for(var d=this.parallel_,n=this.chooseServers_(a),l=jQuery.extend({},a.ajax,a.balance.option.ajax),n=jQuery.grep(n,function(a){return!!a}),k=0,y=n.length,e=function(d){var r=(new Date).getTime();"pending"===b.state()&&jQuery.ajax(jQuery.extend({},l,{url:c.util_.normalizeUrl(g.location.protocol+
"//"+d+g.location.pathname.replace(/^\/?/,"/")+g.location.search),xhr:a.balance.option.callbacks.ajax.xhr?function(){var b;b=c.util_.fire(a.balance.option.callbacks.ajax.xhr,this,[event,a]);return b="object"===typeof b?b:jQuery.ajaxSettings.xhr()}:m,beforeSend:a.balance.option.callbacks.ajax.beforeSend||a.server.header?function(b,h){a.server.header&&b.setRequestHeader(a.nss.requestHeader,"true");"object"===typeof a.server.header&&(b.setRequestHeader(a.nss.requestHeader,"true"),a.server.header.area&&
b.setRequestHeader(a.nss.requestHeader+"-Area",this.app_.chooseArea(a.area,q,q)),a.server.header.head&&b.setRequestHeader(a.nss.requestHeader+"-Head",a.load.head),a.server.header.css&&b.setRequestHeader(a.nss.requestHeader+"-CSS",a.load.css.toString()),a.server.header.script&&b.setRequestHeader(a.nss.requestHeader+"-Script",a.load.script.toString()));c.util_.fire(a.balance.option.callbacks.ajax.beforeSend,this,[event,a,b,h])}:m,dataFilter:a.balance.option.callbacks.ajax.dataFilter?function(b,h){return c.util_.fire(a.balance.option.callbacks.ajax.dataFilter,
this,[event,a,b,h])||b}:m,success:function(b,h,n){r=(new Date).getTime()-r;var k=c.data_.getServerBuffer(this.url),l=c.score(r,n.responseText.length);r=k&&!k.state&&k.time?Math.round((k.time+r)/2):r;l=k&&!k.state&&k.score?Math.round((k.score+l)/2):l;c.data_.saveServer(d,(new Date).getTime()+a.balance.server.expires,r,l,0);d=c.sanitize(n,a)||d;c.util_.fire(a.balance.option.ajax.success,this,arguments)},error:function(b){c.data_.saveServer(d,(new Date).getTime()+a.balance.server.expires,0,0,(new Date).getTime());
d=null;c.util_.fire(a.balance.option.ajax.error,this,arguments)},complete:function(){c.util_.fire(a.balance.option.ajax.complete,this,arguments);++k;b.notify(k,y,d);d?(c.host_(d,a),n.splice(0,n.length),b.resolve(d)):!c.host()&&n.length?e(n.shift()):b.reject()}}))};d--&&n.length;)e(n.shift());return b};return d}();e.Balancer=f})(e.APP||(e.APP={}))})(b.MODEL||(b.MODEL={}))})(f||(f={}));(function(b){(function(b){(function(b){var e=function(){function a(a,b,r,n,l,k){this.data_=a?{url:a,data:b,textStatus:r,
jqXHR:n,host:l,bind:k}:{url:m,data:m,textStatus:m,jqXHR:m,host:m,bind:m};this.data=new d(this.data_)}a.prototype.state=function(a){var b=a?a.cache.expires.min:m;a=a?a.cache.expires.max:m;switch(!1){case this.data.jqXHR()&&200===+this.data.jqXHR().status:case this.data.expires(b,a)>=(new Date).getTime():return!1;default:return!0}};return a}();b.PageRecord=e;var d=function(){function a(a){this.data_=a}a.prototype.url=function(){return this.data_.url};a.prototype.data=function(){return this.data_.data};
a.prototype.textStatus=function(){return this.data_.textStatus};a.prototype.jqXHR=function(){return this.data_.jqXHR};a.prototype.bind=function(){return this.data_.bind};a.prototype.host=function(){return this.data_.host};a.prototype.expires=function(a,b){if(!this.jqXHR()&&!this.data())return 0;var d=this.jqXHR();d&&(d.timeStamp=d.timeStamp||(new Date(d.getResponseHeader("Date"))).getTime()||(new Date).getTime());switch(!0){case !d:d=0;break;case /no-store|no-cache/.test(d.getResponseHeader("Cache-Control")):d=
0;break;case !!d.getResponseHeader("Cache-Control")&&!!~d.getResponseHeader("Cache-Control").indexOf("max-age="):d=(new Date(d.getResponseHeader("Date")||(new Date(d.timeStamp)).toString())).getTime()+1E3*+d.getResponseHeader("Cache-Control").match(/max-age=(\d*)/).pop();break;case !!d.getResponseHeader("Expires"):d=(new Date(d.getResponseHeader("Expires"))).getTime();break;default:d=0}if(m!==a||m!==b)d="number"===typeof a?Math.max(a+(new Date).getTime(),d):d,d="number"===typeof b?Math.min(b+(new Date).getTime(),
d):d;return d=Math.max(d,0)||0};return a}();b.PageRecordData=d})(b.APP||(b.APP={}))})(b.MODEL||(b.MODEL={}))})(f||(f={}));(function(b){(function(b){(function(b){var e=function(){function b(){}b.prototype.chooseArea=function(a,c,b,d){a="string"===typeof a?[a]:a;d=0;a:for(;d<a.length;d++){for(var n=a[d],l=n.match(/(?:[^,\(\[]+|\(.*?\)|\[.*?\])+/g)||[n],k=l.length;k--;){var y=l[k];switch(!0){case 0===jQuery(y,c).length:case jQuery(y,c).length!==jQuery(y,b).length:continue a}}return n}return""};b.prototype.dispatchEvent=
function(a,c,b,d){var n=q.createEvent("HTMLEvents");n.initEvent(c,b,d);a.dispatchEvent(n)};return b}();b.PageUtility=e})(b.APP||(b.APP={}))})(b.MODEL||(b.MODEL={}))})(f||(f={}));(function(b){(function(e){(function(e){var g=function(){function d(a,c,h,d,n,l,k){this.model_=a;this.page_=c;this.balancer_=h;this.setting_=d;this.event_=n;this.success_=l;this.failure_=k;this.util_=b.LIBRARY.Utility;this.binds_=[];this.jsons_=[];this.main_()}d.prototype.main_=function(){function a(a,c,b){return d.call(this,
[].slice.call(arguments),m)}function c(a,c,b){return n.apply(this,arguments)}function h(a,c){return l.apply(this,arguments)}function d(a,c,b){void 0===b&&(b=[]);arguments.length&&arguments[0]&&(k.data_=a[0],k.textStatus_=a[1],k.jqXHR_=a[2],k.binds_=b.every(function(a){return!!a&&"object"===typeof a})?b:[b[2]],k.util_.fire(e.callbacks.ajax.success,this[0]||this,[g,e,k.data_,k.textStatus_,k.jqXHR_]))}function n(a,c,b){arguments.length&&arguments[0]&&(k.jqXHR_=a,k.textStatus_=c,k.errorThrown_=b,k.binds_=
[],k.util_.fire(e.callbacks.ajax.error,this[0]||this,[g,e,k.jqXHR_,k.textStatus_,k.errorThrown_]))}function l(){arguments.length&&arguments[0]&&(k.util_.fire(e.callbacks.ajax.complete,this[0]||this,[g,e,k.jqXHR_,k.textStatus_]),k.model_.setPageXHR(null),k.model_.setDataXHR(null),200===+k.jqXHR_.status&&k.binds_.every(function(a){return 200===+a.status})?(k.binds_.forEach(function(a,c){return k.binds_[c].responseJSON=k.binds_[c].responseJSON||k.jsons_[c]}),k.model_.setCache(e.destLocation.href,u&&
u.data||null,k.textStatus_,k.jqXHR_),k.success_(e,g,k.data_,k.textStatus_,k.jqXHR_,k.host_,k.binds_)):k.failure_(e,g,k.data_,k.textStatus_,k.jqXHR_,k.host_,k.binds_))}var k=this,e=this.setting_,g=this.event_=jQuery.extend(!0,{},this.event_),f=this.util_.fire(e.wait,e,[g,e,e.origLocation.cloneNode(),e.destLocation.cloneNode()]),x=e.speedcheck,z=this.model_.speed;x&&(z.fire=g.timeStamp);x&&z.time.splice(0,100,0);x&&z.name.splice(0,100,"pjax("+z.time.slice(-1)+")");var u;switch(e.cache[g.type.toLowerCase()]&&
g.type.toLowerCase()){case b.EVENT.CLICK:u=this.model_.getCache(e.destLocation.href);break;case b.EVENT.SUBMIT:u=e.cache[g.currentTarget.method.toLowerCase()]?this.model_.getCache(e.destLocation.href):u;break;case b.EVENT.POPSTATE:u=this.model_.getCache(e.destLocation.href)}var p=this.model_.getPageXHR();if(!(p&&4>p.readyState&&p.location&&this.model_.comparePageByUrl(p.location.href,e.destLocation.href)))if(this.dispatchEvent(q,e.nss.event.pjax.fetch,!1,!1),u&&u.jqXHR&&200===+u.jqXHR.status)x&&z.name.splice(0,
1,"cache("+z.time.slice(-1)+")"),this.host_=this.model_.host(),this.model_.setDataXHR(this.bind_(this.util_.fire(e.bind,e,[g,e,e.origLocation.cloneNode(),e.destLocation.cloneNode()]))),p=u.jqXHR,p.location=p.location||e.destLocation.cloneNode(),this.model_.setPageXHR(p),this.page_.loadtime=0,this.host_=this.balancer_.sanitize(u.host,e),this.data_=u.jqXHR.responseText,this.textStatus_=u.textStatus,this.jqXHR_=u.jqXHR,this.model_.isDeferrable?(f=this.wait_(f),this.page_.setWait(f),jQuery.when(jQuery.Deferred().resolve(this.data_,
this.textStatus_,this.jqXHR_),f,jQuery.when.apply(null,this.model_.getDataXHR())).done(d).fail(n).always(l)):(f=jQuery.extend({},jQuery.ajaxSettings,e.ajax),f=f.context||f,a.call(f,this.data_,this.textStatus_,this.jqXHR_),h.call(f,this.jqXHR_,this.textStatus_));else if(p&&p.follow&&!~"error abort timeout parsererror".indexOf(p.statusText))x&&z.time.splice(0,1,p.timeStamp-z.fire),x&&z.name.splice(0,1,"preload("+z.time.slice(-1)+")"),x&&z.time.push(z.now()-z.fire),x&&z.name.push("continue("+z.time.slice(-1)+
")"),this.host_=this.model_.host(),this.model_.setDataXHR(this.bind_(this.util_.fire(e.bind,e,[g,e,e.origLocation.cloneNode(),e.destLocation.cloneNode()]))),p.location=e.destLocation.cloneNode(),this.model_.setPageXHR(p),this.host_=this.model_.host(),this.page_.loadtime=p.timeStamp,f=this.wait_(f),this.page_.setWait(f),delete p.timeStamp,jQuery.when(p,f,jQuery.when.apply(null,this.model_.getDataXHR())).done(d).fail(n).always(l);else{this.page_.loadtime=g.timeStamp;p={};this.host_=this.model_.host();
this.model_.setDataXHR(this.bind_(this.util_.fire(e.bind,e,[g,e,e.origLocation.cloneNode(),e.destLocation.cloneNode()])));x=this.balance_(e.destLocation.href);p.url=e.server.query?[x.protocol,"//",x.host,x.pathname.replace(/^\/?/,"/"),x.search.replace(/&*$/,"&"+e.server.query).replace(/^\??&/,"?").replace(/(\?|&)$/,""),x.hash].join(""):x.href;switch(g.type.toLowerCase()){case b.EVENT.CLICK:p.type="GET";break;case b.EVENT.SUBMIT:p.type=g.currentTarget.method.toUpperCase();switch(p.type){case "POST":jQuery(g.currentTarget).has(":file").length?
"function"===typeof FormData&&(p.data=(new FormData)(g.currentTarget),p.contentType=!1,p.processData=!1):p.data=jQuery(g.currentTarget).serializeArray()}break;case b.EVENT.POPSTATE:p.type="GET"}p=jQuery.extend({},e.ajax,p,{xhr:e.callbacks.ajax.xhr?function(){var a;a=k.util_.fire(e.callbacks.ajax.xhr,this,[g,e]);return a="object"===typeof a?a:jQuery.ajaxSettings.xhr()}:m,beforeSend:e.callbacks.ajax.beforeSend||e.server.header?function(a,c){e.server.header&&a.setRequestHeader(e.nss.requestHeader,"true");
"object"===typeof e.server.header&&(a.setRequestHeader(e.nss.requestHeader,"true"),e.server.header.area&&a.setRequestHeader(e.nss.requestHeader+"-Area",this.app_.chooseArea(e.area,q,q)),e.server.header.head&&a.setRequestHeader(e.nss.requestHeader+"-Head",e.load.head),e.server.header.css&&a.setRequestHeader(e.nss.requestHeader+"-CSS",e.load.css.toString()),e.server.header.script&&a.setRequestHeader(e.nss.requestHeader+"-Script",e.load.script.toString()));k.util_.fire(e.callbacks.ajax.beforeSend,this,
[g,e,a,c])}:m,dataFilter:e.callbacks.ajax.dataFilter?function(a,c){return k.util_.fire(e.callbacks.ajax.dataFilter,this,[g,e,a,c])||a}:m,success:this.model_.isDeferrable?null:a,error:this.model_.isDeferrable?null:c,complete:this.model_.isDeferrable?null:h});p=jQuery.ajax(p);p.location=e.destLocation.cloneNode();this.model_.setPageXHR(p);this.model_.isDeferrable&&(f=this.wait_(f),this.page_.setWait(f),jQuery.when(this.model_.getPageXHR(),f,jQuery.when.apply(null,this.model_.getDataXHR())).done(d).fail(n).always(l))}};
d.prototype.balance_=function(a){var c=q.createElement("a");c.href=a;c.host=this.host_||c.host;return c};d.prototype.bind_=function(a){var c=this;return(a||[]).map(function(a){a.url=c.util_.canonicalizeUrl(a.url);if(-1<a.url.indexOf("//"))return a;a.url=c.balance_(a.url).href;return a}).map(jQuery.ajax).map(function(a,b){return a.done(function(a,h,d){switch(d.getResponseHeader("Content-Type").split("/").pop()){case "json":if(!d.responseJSON)if(c.jsons_[b])for(var e in a)c.jsons_[b][e]=a[e];else c.jsons_[b]=
a}})})};d.prototype.wait_=function(a){var c=jQuery.Deferred();if(!a)return c.resolve();setTimeout(function(){c.resolve()},a);return c};d.prototype.chooseArea=function(a,c,b){};d.prototype.dispatchEvent=function(a,c,b,d){};return d}();e.PageFetch=g})(e.APP||(e.APP={}))})(b.MODEL||(b.MODEL={}))})(f||(f={}));(function(b){(function(b){(function(b){var e=function(){function d(a,c,d,e){this.Record_=a;this.model_=c;this.balancer_=d;this.page_=e;this.hash_=function(a){return a.nss.url};this.table_={};this.order_=
[];this.fetch_=b.PageFetch}d.prototype.fetchRecord=function(a,c,b,d){this.getRecord(a).state(a);this.pullRecord(a,c,b,d)};d.prototype.pullRecord=function(a,c,b,d){var e=this;new this.fetch_(this.model_,this.page_,this.balancer_,a,c,function(a,c,d,r,g,f,m){d=e.setRecord(a,e.getRecord(a).data.data()||"",r,g,f,m);b(d,a,c)},function(a,c,b,h,g,f,m){b=e.setRecord(a,e.getRecord(a).data.data()||"",h,g,f,m);d(b,a,c)})};d.prototype.getRecord=function(a){return this.table_[this.hash_(a)]=this.table_[this.hash_(a)]||
new this.Record_};d.prototype.setRecord=function(a,c,b,d,e,l){this.cleanRecords_(a);this.addOrder_(a);return this.table_[this.hash_(a)]=new this.Record_(a.nss.url,c,b,d,e,l)};d.prototype.removeRecord=function(a){this.removeOrder_(a);return this.table_[this.hash_(a)]=new this.Record_};d.prototype.clearRecord=function(){this.order_.splice(0,this.order_.length);for(var a in this.table_)delete this.table_[a]};d.prototype.cleanRecords_=function(a){if(a.cache.limit)for(;this.order_.length>=a.cache.limit;)this.removeRecord(this.order_.pop())};
d.prototype.addOrder_=function(a){this.removeOrder_(a);this.order_.unshift(a)};d.prototype.removeOrder_=function(a){for(var c=this.order_.length;c--;)this.order_[c].nss.url===a.nss.url&&this.order_.splice(c,1)};return d}();b.PageProvider=e})(b.APP||(b.APP={}))})(b.MODEL||(b.MODEL={}))})(f||(f={}));(function(b){(function(e){(function(e){var f=function(){function d(a,c,d,e,n,l,k){this.model_=a;this.page_=c;this.data_=d;this.balancer_=e;this.setting_=n;this.event_=l;this.record_=k;this.util_=b.LIBRARY.Utility;
this.loadwaits_=[];this.main_()}d.prototype.main_=function(){var a=this.record_,c=this.setting_,d=this.event_,e=c.speedcheck,n=this.model_.speed;e&&n.time.push(n.now()-n.fire);e&&n.name.push("fetch("+n.time.slice(-1)+")");++this.page_.count;this.page_.loadtime=this.page_.loadtime&&(new Date).getTime()-this.page_.loadtime;if(c.cache.mix&&b.EVENT.POPSTATE!==d.type.toLowerCase()&&(new Date).getTime()-d.timeStamp<=c.cache.mix)return this.model_.fallback(d);try{this.page_.landing=null;if(!~(a.data.jqXHR().getResponseHeader("Content-Type")||
"").toLowerCase().search(c.contentType))throw Error("throw: content-type mismatch");this.srcTitle_=jQuery(a.data.jqXHR().responseText.match(/<title(?:\s.*?[^\\])?>(?:.*?[^\\])?<\/title>|$/i).pop()).text();this.dstTitle_=q.title;this.redirect_();this.blur_();this.dispatchEvent(g,c.nss.event.pjax.unload,!1,!1);this.url_();if(!this.model_.comparePageByUrl(c.destLocation.href,g.location.href))throw Error("throw: location mismatch");this.document_()}catch(l){l&&(this.model_.getCache(g.location.href)&&
this.model_.removeCache(c.destLocation.href),this.model_.fallback(d))}};d.prototype.isRegister_=function(a,c){if(a.destLocation.href===a.origLocation.href)return!1;switch(c.type.toLowerCase()){case b.EVENT.CLICK:case b.EVENT.SUBMIT:return!0;case b.EVENT.POPSTATE:return!1}};d.prototype.isReplace_=function(a,c){switch(c.type.toLowerCase()){case b.EVENT.CLICK:case b.EVENT.SUBMIT:return jQuery(c.currentTarget).is(a.replace);case b.EVENT.POPSTATE:return!1}};d.prototype.isCacheUsable_=function(a,c){switch(!0){case !c.cache.click&&
!c.cache.submit&&!c.cache.popstate:case b.EVENT.SUBMIT===a.type.toLowerCase()&&!c.cache[a.currentTarget.method.toLowerCase()]:return!1;default:return!0}};d.prototype.redirect_=function(){var a=this,c=this.setting_,d=this.event_,e=(jQuery('head meta[http-equiv="Refresh"][content*="URL="]').attr("content")||"").match(/(?:\d+;\s*)(.+)|$/).shift();if(e&&!this.model_.comparePageByUrl(c.destLocation.href,e)){var n=c.destLocation.cloneNode();n.href=e;if(!1!==this.util_.fire(c.callbacks.update.redirect.before,
c,[d,c,n.cloneNode(),c.origLocation.cloneNode(),c.destLocation.cloneNode()]))switch(!0){case !c.redirect:case n.protocol!==c.destLocation.protocol:case n.host!==c.destLocation.host:case b.EVENT.SUBMIT===d.type.toLowerCase()&&"GET"!==d.currentTarget.method.toUpperCase():switch(d.type.toLowerCase()){case b.EVENT.CLICK:case b.EVENT.SUBMIT:g.location.assign(n.href);break;case b.EVENT.POPSTATE:g.location.replace(n.href)}throw!1;default:jQuery[b.DEF.NAME].enable();switch(d.type.toLowerCase()){case b.EVENT.CLICK:case b.EVENT.SUBMIT:setTimeout(function(){return jQuery[b.DEF.NAME].click(n.href)},
0);break;case b.EVENT.POPSTATE:g.history.replaceState(g.history.state,this.srcTitle_,n.href),this.isRegister_(c,d)&&c.fix.location&&!this.util_.compareUrl(c.destLocation.href,g.location.href)&&(jQuery[b.DEF.NAME].disable(),g.history.back(),g.history.forward(),jQuery[b.DEF.NAME].enable()),setTimeout(function(){return a.dispatchEvent(g,b.EVENT.POPSTATE,!1,!1)},0)}throw!1;}}};d.prototype.blur_=function(){var a=this.setting_,c=this.event_;!1!==this.util_.fire(a.callbacks.update.blur.before,a,[c,a,a.origLocation.cloneNode(),
a.destLocation.cloneNode()])&&(jQuery(q.activeElement).not("body").blur(),this.util_.fire(a.callbacks.update.blur.after,a,[c,a,a.origLocation.cloneNode(),a.destLocation.cloneNode()]))};d.prototype.url_=function(){var a=this.setting_,c=this.event_;this.model_.location.href=a.destLocation.href;!1===this.util_.fire(a.callbacks.update.url.before,a,[c,a,a.origLocation.cloneNode(),a.destLocation.cloneNode()])?a.destLocation.href=this.util_.canonicalizeUrl(g.location.href):(this.isReplace_(a,c)?(g.history.replaceState(this.util_.fire(a.state,
a,[c,a,a.origLocation.cloneNode(),a.destLocation.cloneNode()]),this.srcTitle_,a.destLocation.href),a.fix.location&&!this.util_.compareUrl(a.destLocation.href,g.location.href)&&g.location.replace(a.destLocation.href)):this.isRegister_(a,c)&&(g.history.pushState(this.util_.fire(a.state,a,[c,a,a.origLocation.cloneNode(),a.destLocation.cloneNode()]),~g.navigator.userAgent.toLowerCase().indexOf("opera")?this.dstTitle_:this.srcTitle_,a.destLocation.href),a.fix.location&&!this.util_.compareUrl(a.destLocation.href,
g.location.href)&&(jQuery[b.DEF.NAME].disable(),g.history.back(),g.history.forward(),jQuery[b.DEF.NAME].enable())),!1===this.util_.fire(a.callbacks.update.url.after,a,[c,a,a.origLocation.cloneNode(),a.destLocation.cloneNode()])&&(a.destLocation.href=this.util_.canonicalizeUrl(g.location.href)))};d.prototype.document_=function(){var a=this,c=this.setting_,d=this.event_;if(c.load.script&&!this.page_.loadedScripts[""]){var e=this.page_.loadedScripts;e[""]=!0;jQuery("script").each(function(){this.src&&
(e[this.src]=!c.load.reload||!jQuery(this).is(c.load.reload))})}this.srcDocument_=this.page_.parser.parse(this.record_.data.jqXHR().responseText,c.destLocation.href);this.dstDocument_=q;var n=c.speedcheck,l=this.model_.speed;n&&l.time.push(l.now()-l.fire);n&&l.name.push("parse("+l.time.slice(-1)+")");this.area_=this.chooseArea(c.area,this.srcDocument_,this.dstDocument_);if(!this.area_)throw Error("throw: area notfound");this.areas_=this.area_.match(/(?:[^,]+?|\(.*?\)|\[.*?\])+/g);this.overwriteDocumentByCache_();
c.fix.noscript&&this.escapeNoscript_(this.srcDocument_);c.fix.reference&&this.fixReference_(c.origLocation.href,this.dstDocument_);this.rewrite_();this.title_();c.fix.history&&this.data_.saveTitle();this.data_.saveExpires(this.record_.data.url(),this.record_.data.host(),this.record_.data.expires());this.head_();n&&l.time.push(l.now()-l.fire);n&&l.name.push("head("+l.time.slice(-1)+")");this.content_();this.focus_();this.dispatchEvent(q,c.nss.event.pjax.DOMContentLoaded,!1,!1);n&&l.time.push(l.now()-
l.fire);n&&l.name.push("content("+l.time.slice(-1)+")");this.balance_();this.css_('link[rel~="stylesheet"], style');jQuery(g).one(b.DEF.NAME+":rendering",function(e){e.preventDefault();e.stopImmediatePropagation();var r=function(b){if(a.model_.comparePageByUrl(c.destLocation.href,g.location.href))return a.dispatchEvent(q,c.nss.event.pjax.ready,!1,!1),jQuery(a.area_).each(function(a,c){return jQuery(c).width()}),jQuery.when?jQuery.Deferred().resolve():b()},f=function(e){if(a.model_.comparePageByUrl(c.destLocation.href,
g.location.href))return a.util_.fire(c.callback,c,[d,c]),setTimeout(function(){switch(d.type.toLowerCase()){case b.EVENT.CLICK:case b.EVENT.SUBMIT:a.model_.overlay(c)||a.scrollByHash_(c)||a.scroll_(!0);break;case b.EVENT.POPSTATE:a.model_.overlay(c)||a.scroll_(!0)}},100),a.dispatchEvent(q,c.nss.event.pjax.render,!1,!1),n&&l.time.push(l.now()-l.fire),n&&l.name.push("render("+l.time.slice(-1)+")"),jQuery.when?jQuery.when.apply(jQuery,a.loadwaits_):e()},m=function(){if(!a.model_.comparePageByUrl(c.destLocation.href,
g.location.href))return jQuery.when&&jQuery.Deferred().reject();a.dispatchEvent(g,c.nss.event.pjax.load,!1,!1);n&&l.time.push(l.now()-l.fire);n&&l.name.push("load("+l.time.slice(-1)+")");n&&console.log(l.time);n&&console.log(l.name);a.script_("[src][defer]");return jQuery.when&&jQuery.Deferred().resolve()};a.scroll_(!1);if(100>a.page_.loadtime&&c.reset.type.match(d.type.toLowerCase())&&!jQuery('form[method][method!="GET"]').length)switch(!1){case a.page_.count<c.reset.count||!c.reset.count:case (new Date).getTime()<
c.reset.time+a.page_.time||!c.reset.time:throw Error("throw: reset");}e=a.script_(":not([defer]), :not([src])");if(jQuery.when){var x=jQuery.Deferred().pipe?"pipe":"then";jQuery.when.apply(jQuery,e)[x](function(){return r()})[x](function(){return f()})[x](function(){return m()})}else r(function(){return f(function(){return m()})})}).trigger(b.DEF.NAME+":rendering")};d.prototype.overwriteDocumentByCache_=function(){var a=this.setting_,c=this.event_,b=this.model_.getCache(a.destLocation.href);if(this.isCacheUsable_(c,
a)&&b&&b.data){c=a.fix.noscript?this.restoreNoscript_(b.data):b.data;a=this.page_.parser.parse(c,a.destLocation.href);c=this.srcDocument_;c.title=a.title;for(var d,e=0;this.areas_[e];e++){b=jQuery(this.areas_[e],a).clone();d=jQuery(this.areas_[e],c);if(!b.length||!d.length||b.length!==d.length)throw Error("throw: area mismatch");for(var l=0;b[l];l++)d[l].parentNode.replaceChild(b[l],d[l])}}};d.prototype.rewrite_=function(){function a(a){if(!a)return{};switch(a.getResponseHeader("Content-Type").split("/").pop()){case "json":return a.responseJSON}}
var c=this.setting_,b=this.event_;c.rewrite&&!1!==this.util_.fire(c.callbacks.update.rewrite.before,c,[b,c,this.srcDocument_,this.dstDocument_])&&(this.util_.fire(c.rewrite,c,[this.srcDocument_,this.area_,this.record_.data.host(),this.record_.data.bind().map(a)]),this.util_.fire(c.callbacks.update.rewrite.before,c,[b,c,this.srcDocument_,this.dstDocument_]))};d.prototype.title_=function(){var a=this.setting_,c=this.event_;!1!==this.util_.fire(a.callbacks.update.title.before,a,[c,a,this.srcDocument_.title,
this.dstDocument_.title])&&(this.dstDocument_.title=this.srcDocument_.title,this.util_.fire(a.callbacks.update.title.after,a,[c,a,this.srcDocument_.title,this.dstDocument_.title]))};d.prototype.head_=function(){var a=this.setting_,c=this.event_,b=this.srcDocument_,d=this.dstDocument_;if(a.load.head&&!1!==this.util_.fire(a.callbacks.update.head.before,a,[c,a,this.srcDocument_.querySelector("head"),this.dstDocument_.querySelector("head")])){for(var b=jQuery(b.head).children("base, meta, link").filter(a.load.head).not(a.load.ignore).not('link[rel~="stylesheet"], style, script'),
e=jQuery(d.head).children("base, meta, link").filter(a.load.head).not(a.load.ignore).not('link[rel~="stylesheet"], style, script'),l=jQuery(),k=e,g=0,f;f=b[g];g++){for(var m=0;k[m];m++)if(k[m].tagName===f.tagName&&k[m].outerHTML===f.outerHTML){l.length&&((f=e[e.index(k[m])-1])?jQuery(f).after(l.clone()):k.eq(m).before(l.clone()),l=jQuery());k=k.not(k[m]);f=null;break}l=l.add(f)}jQuery("title",d).before(l.clone());k.remove();this.util_.fire(a.callbacks.update.head.after,a,[c,a,this.srcDocument_.querySelector("head"),
this.dstDocument_.querySelector("head")])}};d.prototype.content_=function(){function a(){if(jQuery.Deferred){var a=jQuery.Deferred();switch(this.tagName.toLowerCase()){case "img":jQuery(this).one("load error abort",a.resolve);break;case "iframe":case "frame":jQuery(this).one("load",a.resolve)}return a}}var c=this,b=this.setting_,d=this.event_,e=this.srcDocument_,g=this.dstDocument_;if(!1!==this.util_.fire(b.callbacks.update.content.before,b,[d,b,jQuery(this.area_,this.srcDocument_).get(),jQuery(this.area_,
this.dstDocument_).get()])){jQuery(this.area_).children("."+b.nss.elem+"-check").remove();for(var k,f,m=0;this.areas_[m];m++){k=jQuery(this.areas_[m],e);f=jQuery(this.areas_[m],g);if(!k.length||!f.length||k.length!==f.length)throw Error("throw: area mismatch");k=k.map(function(a,c){return q.importNode(c,!0)});k.find("script").each(function(a,b){return c.escapeScript_(b)});this.loadwaits_=this.loadwaits_.concat(k.find("img, iframe, frame").map(a).get());for(var w=0;k[w];w++)f[w].parentNode.replaceChild(k[w],
f[w]),q.body===k[w]&&(jQuery.each(k[w].attributes,function(a,c){return f[w].removeAttribute(c.name)}),jQuery.each(k[w].attributes,function(a,c){return f[w].setAttribute(c.name,c.value)}));f=jQuery(this.areas_[m],g);f.find("script").each(function(a,b){return c.restoreScript_(b)})}this.util_.fire(b.callbacks.update.content.after,b,[d,b,jQuery(this.area_,this.srcDocument_).get(),jQuery(this.area_,this.dstDocument_).get()])}};d.prototype.focus_=function(){var a=this.setting_,c=this.event_;!1!==this.util_.fire(a.callbacks.update.focus.before,
a,[c,a,a.origLocation.cloneNode(),a.destLocation.cloneNode()])&&(jQuery("body, input[autofocus], textarea[autofocus]").last().not(q.activeElement).focus(),this.util_.fire(a.callbacks.update.focus.after,a,[c,a,a.origLocation.cloneNode(),a.destLocation.cloneNode()]))};d.prototype.balance_=function(){var a=this,c=this.setting_,b=this.event_;!c.balance.active||100>this.page_.loadtime||[this.record_.data.jqXHR()].concat(this.record_.data.bind()).forEach(function(d){var e=a.balancer_.sanitize(d,c)||a.record_.data.host()||
"",g=a.page_.loadtime,k;a.balancer_.score(g,d.responseText.length);if(!1!==a.util_.fire(c.callbacks.update.balance.before,c,[b,c,e,a.page_.loadtime,d.responseText.length])){var f=a.data_.getServerBuffer(c.destLocation.href);k=a.balancer_.score(g,d.responseText.length);g=f&&!f.state&&f.time?Math.round((f.time+g)/2):g;k=f&&!f.state&&f.score?Math.round((f.score+k)/2):k;a.data_.saveServer(e,(new Date).getTime()+c.balance.server.expires,g,k,0);a.balancer_.changeServer(a.balancer_.chooseServer(c),c);a.util_.fire(c.callbacks.update.balance.after,
c,[b,c,e,a.page_.loadtime,d.responseText.length])}})};d.prototype.css_=function(a){function c(){return jQuery.contains(g.head,this)}function b(){return jQuery.contains(g.body,this)}var d=this.setting_,e=this.event_,g=this.srcDocument_,k=this.dstDocument_;if(d.load.css){var f=jQuery("link, style",g).filter(a).not(jQuery("noscript",g).find("link, style")),m=jQuery("link, style",k).filter(a).not(jQuery("noscript",g).find("link, style")),w=jQuery(),q=m;if(!1!==this.util_.fire(d.callbacks.update.css.before,
d,[e,d,f.get(),m.get()])){for(var f=f.not(d.load.ignore),m=f.not(d.load.ignore),u=0,v;v=f[u];u++){for(var p=0,t;q[p];p++){switch(v.tagName.toLowerCase()){case "link":t=v.href===q[p].href;break;case "style":t=this.util_.trim(v.innerHTML)===this.util_.trim(q[p].innerHTML)}if(t){w.length&&(jQuery.contains(k.body,q[p])&&w.first().parents("head").length?(jQuery(k.head).append(w.filter(c).clone()),q.eq(p).before(w.filter(b).clone())):(v=m[m.index(q[p])-1])?jQuery(v).after(w.clone()):q.eq(p).before(w.clone()),
w=jQuery());q=q.not(q[p]);p-=Number(!!p);v=null;break}}w=w.add(v)}jQuery(k.head).append(w.filter(c).clone());jQuery(k.body).append(w.filter(b).clone());q.remove();m=jQuery("link, style",k).filter(a).not(jQuery("noscript",g).find("link, style"));!1!==this.util_.fire(d.callbacks.update.css.after,d,[e,d,f.get(),m.get()])&&(a=d.speedcheck,d=this.model_.speed,a&&d.time.push(d.now()-d.fire),a&&d.name.push("css("+d.time.slice(-1)+")"))}}};d.prototype.script_=function(a){var c=this,b=this.setting_,d=this.event_,
e=this.srcDocument_,f=this.dstDocument_,k=[],m=[];if(!b.load.script)return k;var e=jQuery("script",e).filter(a).not(jQuery("noscript",e).find("script")),q=jQuery("script",f).filter(a).not(jQuery("noscript",f).find("script")),u=this.page_.loadedScripts,x=/^$|(?:application|text)\/(?:java|ecma)script/i,v=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g;if(!1===this.util_.fire(b.callbacks.update.script.before,b,[d,b,e.get(),q.get()]))return k;for(var e=e.not(b.load.ignore),A=function(a,d){if(!c.model_.comparePageByUrl(b.destLocation.href,
g.location.href))return!1;a.src&&(u[a.src]=!b.load.reload||!jQuery(a).is(b.load.reload));try{if(c.model_.isDeferrable)if("string"===typeof d)eval.call(g,d);else throw d;else a.hasAttribute("src")?jQuery.ajax(jQuery.extend(!0,{},b.ajax,b.load.ajax,{url:a.src,dataType:"script",async:!1,global:!1,success:function(){return null},error:function(a){throw a;}})):eval.call(g,(a.text||a.textContent||a.innerHTML||"").replace(v,""));try{a.hasAttribute("src")&&c.dispatchEvent(a,"load",!1,!1)}catch(e){}}catch(e){try{a.hasAttribute("src")&&
c.dispatchEvent(a,"error",!1,!1)}catch(f){}if(!0===b.load.error)throw e;c.util_.fire(b.load.error,b,[e,a])}},q=0,p;p=e[q];q++)if(x.test(p.type||"")&&(p.hasAttribute("src")?!u[p.src]:this.util_.trim(p.innerHTML))){var t=jQuery(p).parent(b.load.log)[0];if(t&&!jQuery(p).parents(this.area_).length){var t=jQuery(t.id||t.tagName,f)[0],B=p.cloneNode(!0);this.escapeScript_(B);t.appendChild(B);this.restoreScript_(B)}(function(a){var d=c.model_.isDeferrable&&jQuery.Deferred();a.hasAttribute("src")&&a.getAttribute("src")?
(u[a.src]=!b.load.reload||!jQuery(a).is(b.load.reload),a.hasAttribute("async")?jQuery.ajax(jQuery.extend({},b.ajax,b.load.ajax,{url:a.src,dataType:"script",async:!0,global:!1,success:function(){return c.dispatchEvent(a,"load",!1,!1)},error:function(){return c.dispatchEvent(a,"error",!1,!1)}})):d?(jQuery.ajax(jQuery.extend({},b.ajax,b.load.ajax,{url:a.src,dataType:"text",async:!0,global:!1,success:function(c){return d.resolve([a,c])},error:function(c){return d.resolve([a,c])}})),k.push(d)):m.push(a)):
a.hasAttribute("src")||(d?k.push(d.resolve([a,(a.text||a.textContent||a.innerHTML||"").replace(v,"")])):m.push(a))})(p)}try{this.model_.isDeferrable?jQuery.when.apply(jQuery,k).always(function(){for(var a=[],b=0;b<arguments.length;b++)a[b-0]=arguments[b];return jQuery.each(a,function(a,b){return A.apply(c,b)})}):jQuery.each(m,function(a,c){return A(c)})}catch(C){throw setTimeout(function(){return c.model_.fallback(d)},1),C;}q=jQuery("script",f).filter(a).not(jQuery("noscript",f).find("script"));if(!1===
this.util_.fire(b.callbacks.update.script.after,b,[d,b,e.get(),q.get()]))return k;a=b.speedcheck;f=this.model_.speed;a&&f.time.push(f.now()-f.fire);a&&f.name.push("script("+f.time.slice(-1)+")");return k};d.prototype.scroll_=function(a){var c=this.setting_,d=this.event_;if(!1!==this.util_.fire(c.callbacks.update.scroll.before,c,[d,c])){var e,f;switch(d.type.toLowerCase()){case b.EVENT.CLICK:case b.EVENT.SUBMIT:e=a&&"function"===typeof c.scrollLeft?this.util_.fire(c.scrollLeft,c,[d,c,c.origLocation.cloneNode(),
c.destLocation.cloneNode()]):c.scrollLeft;e=0<=e?e:0;e=!1===e||null===e?jQuery(g).scrollLeft():parseInt(Number(e)+"",10);f=a&&"function"===typeof c.scrollTop?this.util_.fire(c.scrollTop,c,[d,c,c.origLocation.cloneNode(),c.destLocation.cloneNode()]):c.scrollTop;f=0<=f?f:0;f=!1===f||null===f?jQuery(g).scrollTop():parseInt(Number(f)+"",10);g.scrollTo(e,f);break;case b.EVENT.POPSTATE:a&&c.fix.scroll&&this.data_.loadScrollPosition()}a&&this.data_.saveScrollPosition();this.util_.fire(c.callbacks.update.scroll.after,
c,[d,c])}};d.prototype.scrollByHash_=function(a){a=a.destLocation.hash.replace(/^#/,"");if(!a)return!1;a=jQuery("#"+a+", [name~="+a+"]").first();return a.length?(isFinite(a.offset().top)&&g.scrollTo(jQuery(g).scrollLeft(),parseInt(Number(a.offset().top)+"",10)),this.data_.saveScrollPosition(),!0):!1};d.prototype.fixReference_=function(a,c){var b=a.replace(/[^/]+$/,""),d=c.URL.replace(/[^/]+$/,""),b=b.split("/").length,d=d.split("/").length,e=/^.+?\w\//,f=this.util_.repeat("../",Math.abs(b-d)),g;switch(!0){case b===
d:g=0;break;case b<d:g=1;break;case b>d:g=-1}jQuery("[href], [src]",c).not('[href^="/"],[href^= "http:"],[href^= "https:"],[src^= "/"],[src^= "http:"],[src^= "https:"]').each(function(a,c){var b;switch(!0){case "href"in c:b="href";break;case "src"in c:b="src";break;default:return}switch(g){case 1:c[b]=f+c.getAttribute(b);break;case -1:c[b]=c.getAttribute(b).replace(f,"")}c.setAttribute(b,c[b].replace(e,"/"))})};d.prototype.escapeNoscript_=function(a){jQuery("noscript",a).children().parent().each(function(){jQuery(this).text(this.innerHTML)})};
d.prototype.restoreNoscript_=function(a){var c=jQuery("<span/>");return a.replace(/(<noscript>)([^<>]+?)(<\/noscript>)/gim,function(a,b,d,e){return b+c.html(d).text()+e})};d.prototype.escapeScript_=function(a){jQuery.data(a,"source",a.src);jQuery.data(a,"code",a.innerHTML);a.removeAttribute("src");a.innerHTML=""};d.prototype.restoreScript_=function(a){m!==jQuery.data(a,"code")&&(a.innerHTML=" ",jQuery.data(a,"source")?(a.src=jQuery.data(a,"source"),jQuery.removeData(a,"source")):a.removeAttribute("src"),
a.innerHTML=jQuery.data(a,"code"),jQuery.removeData(a,"code"))};d.prototype.chooseArea=function(a,c,b){};d.prototype.dispatchEvent=function(a,c,b,d){};return d}();e.PageUpdate=f})(e.APP||(e.APP={}))})(b.MODEL||(b.MODEL={}))})(f||(f={}));(function(b){(function(e){(function(e){var f=function(){function a(){this.util_=b.LIBRARY.Utility;this.sandbox_cache_={}}a.prototype.sandbox_=function(a){var b=this;void 0===a&&(a=g.location.href);a=this.util_.canonicalizeUrl(a).split("#").shift();this.sandbox_cache_[a]&&
"object"===typeof this.sandbox_cache_[a].document&&this.sandbox_cache_[a].document.URL===a||jQuery('<iframe srcdoc="<!DOCTYPE html>" sandbox="allow-same-origin"></iframe>').appendTo("body").each(function(d,e){b.sandbox_cache_[a]=e.contentWindow;b.sandbox_cache_[a].document.open();b.sandbox_cache_[a].document.close()}).remove();return this.sandbox_cache_[a]};a.prototype.test_=function(a){try{var b=this.parse('<html lang="en" class="html"><head><title>&amp;</title><link href="/"><noscript><style>/**/</style></noscript></head><body><noscript>noscript</noscript><a href="/"></a></body></html>',
g.location.href,a);switch(!1){case !!b:case b.URL&&decodeURI(b.URL)===decodeURI(g.location.href):case "&"===b.title:case !!b.querySelector('html.html[lang="en"]'):case !!b.querySelector("head>link").href:case !!b.querySelector("head>noscript").innerHTML:case !!b.querySelector("body>noscript").innerHTML:case !!b.querySelector("body>a").href:throw!0;}return a}catch(d){}};a.prototype.parse=function(a,b,d){void 0===b&&(b="");void 0===d&&(d=this.mode_);a+=~a.search(/<title[\s>]/i)?"":"<title></title>";
switch(d){case "dom":b=(new g.DOMParser).parseFromString(a,"text/html");break;case "doc":b=q.implementation.createHTMLDocument("");if("object"!==typeof b.activeElement||!b.activeElement)break;"function"===typeof g.DOMParser&&(b.title=(new g.DOMParser).parseFromString(a.match(/<title(?:\s.*?[^\\])?>(?:.*?[^\\])?<\/title>|$/i),"text/html").title);b.open();b.write(a);b.close();b.title!==b.querySelector("title").textContent&&(b.title=b.querySelector("title").textContent);break;case "manipulate":b=q.implementation.createHTMLDocument("");
d=q.createElement("div");d.innerHTML=a.match(/<html(?:\s.*?[^\\])?>|$/i).shift().replace(/html/i,"div")||"<div>";d=d.firstChild.attributes;for(var e=0,f;f=d[e];e++)b.documentElement.setAttribute(f.name,f.value);d=q.createElement("html");d.innerHTML=a.replace(/^.*?<html(?:\s.*?[^\\])?>/im,"");b.documentElement.removeChild(b.head);for(b.documentElement.removeChild(b.body);d.childNodes.length;)b.documentElement.appendChild(d.childNodes[0]);break;case null:b=null;break;default:switch(/webkit|firefox|trident|$/i.exec(g.navigator.userAgent).shift().toLowerCase()){case "webkit":this.mode_=
this.test_("doc")||this.test_("dom")||this.test_("manipulate");break;case "firefox":this.mode_=this.test_("dom")||this.test_("doc")||this.test_("manipulate");break;case "trident":this.mode_=this.test_("manipulate")||this.test_("dom")||this.test_("doc");break;default:this.mode_=this.test_("dom")||this.test_("doc")||this.test_("manipulate")}b=this.mode_&&this.parse(a,b)}return b};return a}();e.PageParser=f;var d=function(){function a(){a.instance_=a.instance_||new f}a.prototype.singleton_=function(){return a.instance_};
a.prototype.parse=function(a,b){return this.singleton_().parse(a,b)};return a}();e.PageParserSingleton=d})(e.APP||(e.APP={}))})(b.MODEL||(b.MODEL={}))})(f||(f={}));(function(b){(function(e){(function(e){b.MIXIN(e.PageFetch,[e.PageUtility]);b.MIXIN(e.PageUpdate,[e.PageUtility]);var f=function(){function d(a,c,d){var f=this;this.model_=a;this.data_=c;this.balancer_=d;this.util_=b.LIBRARY.Utility;this.parser=new e.PageParserSingleton;this.provider=new e.PageProvider(e.PageRecord,this.model_,this.balancer_,
this);this.landing=this.util_.normalizeUrl(g.location.href);this.loadedScripts={};this.dataXHR=[];this.count=this.loadtime=0;this.time=(new Date).getTime();setTimeout(function(){return f.parser.parse("")||f.model_.disable()},100)}d.prototype.transfer=function(a,c){switch(c.type.toLowerCase()){case b.EVENT.CLICK:this.data_.saveTitle();this.data_.saveScrollPosition();break;case b.EVENT.SUBMIT:this.data_.saveTitle();this.data_.saveScrollPosition();break;case b.EVENT.POPSTATE:this.data_.saveTitle(a.origLocation.href,
q.title),a.fix.history&&this.data_.loadTitle()}a=jQuery.extend(!0,{},a);a.origLocation=a.origLocation.cloneNode();a.destLocation=a.destLocation.cloneNode();a=b.FREEZE(a);this.fetch_(a,c)};d.prototype.getWait=function(){return this.wait_};d.prototype.setWait=function(a){this.wait_&&this.wait_.state&&"pending"===this.wait_.state()&&this.wait_.reject();return this.wait_=a};d.prototype.fetch_=function(a,b){var d=this;this.provider.fetchRecord(a,b,function(a,b,c){return d.success_(a,b,c)},function(a,b,
c){return d.failure_(a,b,c)})};d.prototype.success_=function(a,b,d){new e.PageUpdate(this.model_,this,this.data_,this.balancer_,b,d,a)};d.prototype.failure_=function(a,b,d){var e=this;b.fallback&&"abort"!==a.data.textStatus()&&(this.data_.saveExpires(b.destLocation.href,"",0),b.balance.active&&(this.data_.saveServer(a.data.host(),(new Date).getTime()+b.balance.server.expires,0,0,(new Date).getTime()),this.balancer_.changeServer(this.balancer_.chooseServer(b),b)),setTimeout(function(){return e.model_.fallback(d)},
100))};d.prototype.chooseArea=function(a,b,d){};d.prototype.dispatchEvent=function(a,b,d,e){};return d}();e.Page=f})(e.APP||(e.APP={}))})(b.MODEL||(b.MODEL={}))})(f||(f={}));(function(b){(function(e){(function(e){b.MIXIN(e.Page,[e.PageUtility]);var f=function(){function d(a,c){this.model_=a;this.controller_=c;this.util_=b.LIBRARY.Utility;this.settings_={};this.data=new e.Data(this.model_);this.balancer=new e.Balancer(this.data);this.page=new e.Page(this.model_,this.data,this.balancer)}d.prototype.initialize=
function(a,b){var d=this;this.controller_.view(a,b);this.balancer.enable(b);this.balancer.changeServer(this.balancer.chooseServer(b),b);this.data.loadBuffers();setTimeout(function(){return d.page.landing=null},1500)};d.prototype.configure=function(a){var c=this,d=a.preventDefault?a:null;switch(d&&"object"===typeof d&&d.type.toLowerCase()){case b.EVENT.CLICK:return this.configure(d.currentTarget);case b.EVENT.SUBMIT:return this.configure(d.currentTarget);case b.EVENT.POPSTATE:return this.configure(g.location)}var e;
switch(!0){case "string"===typeof a:e=a;break;case "href"in a&&"string"===typeof a.href:e=this.util_.normalizeUrl(a.href);break;case "href"in a&&"object"===typeof a.href:e=this.util_.normalizeUrl(a.href.baseVal);break;case "action"in a:e=this.util_.normalizeUrl(a.action.replace(/[?#].*/,""));switch(a.method.toUpperCase()){case "GET":e+="?"+jQuery(a).serialize()}break;default:e=this.model_.location.href,this.option_=a}a=[this.util_.canonicalizeUrl(this.model_.location.href).slice(0,2048),this.util_.canonicalizeUrl(e).slice(0,
2048)].join(" ");if(!this.option_)return null;if(a in this.settings_)return this.settings_[a];var d=this.model_.location.cloneNode(),f=this.model_.location.cloneNode();d.href=this.util_.canonicalizeUrl(d.href);f.href=this.util_.canonicalizeUrl(e);e=this.scope_(this.option_,d.href,f.href)||null;var l={area:"body",link:"a:not([target])",filter:function(){var a=q.createElement("a");a.href="string"===typeof this.href?this.href:this.href.baseVal;return/^https?:/.test(a.href)&&/\/[^.]*$|\.(html?|php)$/.test(a.pathname.replace(/^\/?/,
"/"))},form:null,replace:null,bind:null,rewrite:null,scope:null,state:null,scrollTop:0,scrollLeft:0,ajax:{dataType:"text"},contentType:"text/html",redirect:!0,cache:{click:!1,submit:!1,popstate:!1,get:!0,post:!0,mix:0,limit:100,expires:{max:null,min:3E5}},buffer:{limit:30,delay:500},load:{head:"",css:!1,script:!1,ignore:'[src*="jquery.js"], [src*="jquery.min.js"], [href^="chrome-extension://"]',reload:"",log:"head, body",error:!0,ajax:{dataType:"script",cache:!0}},balance:{active:!1,bounds:["*"],
weight:1,random:0,option:{server:{header:!1},ajax:{crossDomain:!0},callbacks:{ajax:{beforeSend:null}}},client:{hosts:[],support:{browser:/msie|trident.+ rv:|chrome|firefox|safari/i,redirect:/chrome|firefox|safari/i},cookie:{balance:"balanceable",redirect:"redirectable",host:"host"}},server:{header:"X-Ajax-Host",respite:6E5,expires:864E6}},wait:0,fallback:!0,reset:{type:"",count:100,time:108E5},fix:{location:!0,history:!0,scroll:!0,noscript:!0,reference:!0},database:{active:!0,revision:0,refresh:10},
server:{query:null,header:!0},overlay:"",callback:null,callbacks:{ajax:{},update:{redirect:{},blur:{},url:{},rewrite:{},title:{},head:{},content:{},focus:{},scroll:{},css:{},script:{},balance:{}}},data:m},d={uid:b.UUID(),ns:"",nss:m,speedcheck:m,origLocation:d,destLocation:f,scroll:{queue:[]},option:this.option_},k;k=jQuery.extend(!0,l,e||this.option_);k=jQuery.extend(!0,k,k.balance.active&&k.balance.option,d);k=jQuery.extend(!0,k,function(){k.ns=k.ns?k.ns.split(".").sort().join("."):"";var a=[b.DEF.NAME].concat(k.ns?
k.ns.split("."):[]),d=k.server.query;switch(d&&typeof d){case "string":d=eval("({"+d.toString().match(/[^?=&]+=[^&]*/g).join("&").replace(/"/g,'\\"').replace(/([^?=&]+)=([^&]*)/g,'"$1": "$2"').replace(/&/g,",")+"})");case "object":d=jQuery.param(d);break;default:d=""}return{uid:m,ns:m,origLocation:m,destLocation:m,scroll:m,option:m,speedcheck:m,nss:{array:a,name:a.join("."),data:a[0],url:c.model_.convertUrlToKey(k.destLocation.href,!0),event:{pjax:{fetch:[b.EVENT.PJAX,"fetch"].join(":"),unload:[b.EVENT.PJAX,
"unload"].join(":"),DOMContentLoaded:[b.EVENT.PJAX,"DOMContentLoaded"].join(":"),ready:[b.EVENT.PJAX,"ready"].join(":"),render:[b.EVENT.PJAX,"render"].join(":"),load:[b.EVENT.PJAX,"load"].join(":")},click:[b.EVENT.CLICK].concat(a.join(":")).join("."),submit:[b.EVENT.SUBMIT].concat(a.join(":")).join("."),popstate:[b.EVENT.POPSTATE].concat(a.join(":")).join("."),scroll:[b.EVENT.SCROLL].concat(a.join(":")).join(".")},elem:a.join("-"),requestHeader:["X",a[0].replace(/^\w/,function(a){return a.toUpperCase()})].join("-")},
fix:/android|iphone os|like mac os x/i.test(g.navigator.userAgent)?m:{location:!1},contentType:k.contentType.replace(/\s*[,;]\s*/g,"|").toLowerCase(),database:{refresh:Math.min(k.database.refresh,30)},reset:{type:(k.reset.type||"").toLowerCase()},server:{query:d},timeStamp:(new Date).getTime()}}());return e?(b.FREEZE(k,!0),this.settings_[a]=k):this.settings_[a]=null};d.prototype.scope_=function(a,b,d){a=jQuery.extend(!0,{},a);if(!a.scope)return a;var e=a.scope,f,g,k;b=this.model_.convertUrlToKey(b,
!0).match(/.+?\w(\/.*)/).pop();d=this.model_.convertUrlToKey(d,!0).match(/.+?\w(\/.*)/).pop();f=b.split("/");for(var q=f.length;q--;)if(g=f.slice(0,q+1).join("/"),(g+="/"===b.charAt(g.length)?"/":"")&&g in e){var u;e[g]instanceof Array?(k="",u=e[g]):(k=e[g],u=e[k]);if(u){u=u.concat();var w,v,z,A=[];z=g=w=v=m;for(var p=0,t;t=u[p];p++){if("#"===t.charAt(0))if(!~jQuery.inArray(t,A)&&1<t.length)A.push(t),k=t.slice(1),[].splice.apply(u,[p,1].concat(e[k],"#")),t=u[p];else{k="";continue}if("inherit"===t)z=
!0;else if("string"===typeof t){var B="!"===t.charAt(0);t=B?t.slice(1):t;var C="*"===t.charAt(0);t=C?t.slice(1):t;if(C?~b.search(t):~b.indexOf(t))B?w=!1:(w=!0,g=e["$"+k]||e["$"+t]||m);if(C?~d.search(t):~d.indexOf(t))B?v=!1:(v=!0,g=e["$"+k]||e["$"+t]||m)}if(!1===w||!1===v)return null}if(w&&v)return jQuery.extend(!0,a,g);if(!z)break}}return m};return d}();e.Main=f})(e.APP||(e.APP={}))})(b.MODEL||(b.MODEL={}))})(f||(f={}));(function(b){b=b.MODEL||(b.MODEL={});b.App=b.APP.Main})(f||(f={}));(function(b){(function(e){var f=
function(d){function a(){d.call(this,b.State.initiate);this.controller_=(new b.Controller(this)).singleton();this.app_=new e.App(this,this.controller_);this.util_=b.LIBRARY.Utility;this.isDeferrable=!!jQuery.when&&"1.006"<=jQuery().jquery.match(/\d[\d.]+\d/).pop().replace(/\.(\d+)/g,".00$1").replace(/0*(\d{3})/g,"$1");this.location=q.createElement("a");this.queue_=[]}v(a,d);a.prototype.host=function(){return this.app_.balancer.host()};a.prototype.state=function(){return this.state_};a.prototype.main_=
function(a,d){var e=this;switch(typeof d){case "object":a=a instanceof b.DEF.NAMESPACE?a:jQuery(q)[b.DEF.NAME]();b.FREEZE(d,!0);break;default:return a}if(!g.history||!g.history.pushState||!g.history.replaceState)return a;this.location.href=this.util_.normalizeUrl(g.location.href);var f=this.app_.configure(d);if(!f)return a;this.app_.data.connect(f);this.speed={fire:0,time:[],name:[],now:function(){return(new Date).getTime()}};jQuery(function(){e.app_.initialize(a,f);e.state_=e.state()===b.State.initiate?
b.State.open:e.state();e.overlay(f,!0)});return a};a.prototype.convertUrlToKey=function(a,b){a=b?this.util_.canonicalizeUrl(a):a;return this.util_.trim(a).split("#").shift()};a.prototype.compareKeyByUrl=function(a,b){a=this.convertUrlToKey(a,!0);b=this.convertUrlToKey(b,!0);return a===b};a.prototype.comparePageByUrl=function(a,b){a=this.convertUrlToKey(a,!0);b=this.convertUrlToKey(b,!0);return a===b};a.prototype.configure=function(a){return this.app_.configure(a)};a.prototype.isOperatable=function(a){if(b.State.open!==
this.state()||1<a.which||a.metaKey||a.ctrlKey||a.shiftKey||a.altKey)return!1;var d;switch(a.type.toLowerCase()){case b.EVENT.CLICK:if((d=this.app_.configure(a.currentTarget))&&!jQuery(a.currentTarget).filter(d.filter).length)return!1;break;case b.EVENT.SUBMIT:d=this.app_.configure(a.currentTarget);break;case b.EVENT.POPSTATE:d=this.app_.configure(g.location)}if(!d||d.origLocation.protocol!==d.destLocation.protocol||d.origLocation.host!==d.destLocation.host)return!1;switch(a.type.toLowerCase()){case b.EVENT.CLICK:if(this.comparePageByUrl(d.origLocation.href,
d.destLocation.href)&&d.destLocation.hash)return!1;break;case b.EVENT.POPSTATE:if(this.comparePageByUrl(d.origLocation.href,d.destLocation.href))return!1}return this.app_.page.chooseArea(d.area,q,q)?!0:!1};a.prototype.getPageXHR=function(){return this.app_.page.pageXHR};a.prototype.setPageXHR=function(a){this.app_.page.pageXHR&&4>this.app_.page.pageXHR.readyState&&this.app_.page.pageXHR!==a&&this.app_.page.pageXHR.abort();return this.app_.page.pageXHR=a};a.prototype.getDataXHR=function(){return this.app_.page.dataXHR};
a.prototype.setDataXHR=function(a){a=a||[];var b=this.app_.page.dataXHR;return this.app_.page.dataXHR=Array.apply(null,Array(Math.max(a.length,this.app_.page.dataXHR.length))).map(function(d,e){var f;a:{switch(!0){case e>=b.length:case 4===b[e].readyState:case -1<b.indexOf(a[e]):f=a[e];break a}b[e].abort();f=a[e]}return f}).filter(function(a){return!!a})};a.prototype.click=function(a){a.timeStamp=(new Date).getTime();var d=a.currentTarget;jQuery(d);var e=this.app_.configure(d);this.location.href=
this.util_.normalizeUrl(g.location.href);switch(!0){case a.isDefaultPrevented():case this.state()!==b.State.open:break;case this.isOperatable(a):this.app_.page.transfer(e,a);a.preventDefault();break;case this.isHashChange(e)&&this.overlay(e):a.preventDefault();g.history.pushState(null,q.title,e.destLocation.href);break;case !a.originalEvent&&!jQuery(q).has(d).length:this.fallback(a)}};a.prototype.submit=function(a){a.timeStamp=(new Date).getTime();var d=a.currentTarget;jQuery(d);var e=this.app_.configure(d);
this.location.href=this.util_.normalizeUrl(g.location.href);switch(!0){case a.isDefaultPrevented():case this.state()!==b.State.open:break;case this.isOperatable(a):this.app_.page.transfer(e,a);a.preventDefault();break;case !a.originalEvent&&!jQuery(q).has(d).length:this.fallback(a)}};a.prototype.popstate=function(a){if(!this.app_.page.landing||!this.util_.compareUrl(this.app_.page.landing,g.location.href)){a.timeStamp=(new Date).getTime();var d=this.app_.configure(g.location);switch(!0){case !d:!this.comparePageByUrl(this.location.href,
g.location.href)&&this.fallback(a);break;case this.state()!==b.State.open:break;case this.isOperatable(a):this.app_.page.transfer(d,a);break;case this.isHashChange(d)&&this.overlay(d):break;case !this.comparePageByUrl(d.origLocation.href,g.location.href):this.fallback(a)}this.location.href=this.util_.normalizeUrl(g.location.href)}};a.prototype.scroll=function(a,b){for(var d=this,e;e=this.queue_.shift();)clearTimeout(e);e=setTimeout(function(){for(;e=d.queue_.shift();)clearTimeout(e);d.compareKeyByUrl(g.location.href,
d.location.href)&&d.app_.data.saveScrollPosition()},300);this.queue_.push(e)};a.prototype.fallback=function(a){var b=this.configure(a);switch(!0){case b&&!b.fallback:case b&&!1===this.util_.fire(b.fallback,b,[a,b,b.origLocation.cloneNode(),b.destLocation.cloneNode()]):break;default:this.movePageNormally_(a)}};a.prototype.movePageNormally_=function(a){switch(a.type.toLowerCase()){case b.EVENT.CLICK:"string"===typeof a.currentTarget.href?g.location.assign(a.currentTarget.href):g.location.assign(a.currentTarget.href.baseVal);
break;case b.EVENT.SUBMIT:switch(a.currentTarget.method.toUpperCase()){case "GET":g.location.assign(a.currentTarget.action.replace(/[?#].*/,"")+"?"+jQuery(a.currentTarget).serialize());break;case "POST":g.location.assign(a.currentTarget.action)}break;case b.EVENT.POPSTATE:g.location.reload()}};a.prototype.isHashChange=function(a){return!!a&&a.origLocation.href.replace(/#.*/,"")===a.destLocation.href.replace(/#.*/,"")&&a.origLocation.hash!==a.destLocation.hash};a.prototype.overlay=function(a,b){var d=
this,e=a.destLocation.hash.replace(/^#/,"");if(!e||!a.overlay)return!1;e=jQuery("#"+e+", [name~="+e+"]");e=e.add(e.nextUntil(":header"));e=e.filter(a.overlay).add(e.find(a.overlay)).first();if(!e.length)return!1;this.isHashChange(a)&&(this.app_.data.loadScrollPosition(),setTimeout(function(){return d.app_.data.loadScrollPosition()},1));var f=jQuery("<div>"),e=e.clone(!0);f.addClass(a.nss.elem+"-overlay").css({background:"rgba(255, 255, 255, 0.8)",display:"none",position:"fixed",top:0,left:0,right:0,
bottom:0,margin:0,padding:0,border:"none"}).append(e.css({position:"absolute",top:0,left:0,right:0,bottom:0,margin:"auto"}).show());f.bind("click",f,function(a){a.target===a.currentTarget&&(g.history.pushState(g.history.state,q.title,g.location.href.replace(/#.*/,"")),d.location.href=d.util_.normalizeUrl(g.location.href),jQuery(a.data).fadeOut("fast",function(){return jQuery(a.data).remove()}))});f.appendTo("body").fadeIn(b?0:100);jQuery(g).one("popstate",f,function(a){setTimeout(function(){return d.app_.data.loadScrollPosition()},
1);jQuery(a.data).fadeOut("fast",function(){return jQuery(a.data).remove()})});/trident/i.test(g.navigator.userAgent)&&e.width(e.width());this.app_.data.saveScrollPosition();return!0};a.prototype.enable=function(){this.state_=b.State.open};a.prototype.disable=function(){this.state_=b.State.pause};a.prototype.getCache=function(a){var b=this.configure(this.convertUrlToKey(a));if(b){var d=this.app_.page.provider.getRecord(b);return d.state(b)||d.data.data()?{data:d.data.data(),textStatus:d.data.textStatus(),
jqXHR:d.data.jqXHR(),expires:d.data.expires(),host:d.data.host()}:void this.removeCache(a)}};a.prototype.setCache=function(a,b,d,e){if(a=this.configure(this.convertUrlToKey(a))){var f=this.app_.page.provider.getRecord(a);this.app_.page.provider.setRecord(a,b||"",d||f.data.textStatus(),e||f.data.jqXHR(),this.app_.balancer.sanitize(e,a)||f.data.host()||"",null)}};a.prototype.removeCache=function(a){(a=this.configure(this.convertUrlToKey(a)))&&this.app_.page.provider.removeRecord(a)};a.prototype.clearCache=
function(){this.app_.page.provider.clearRecord()};a.prototype.bypass=function(){return this.app_.balancer.bypass(this.app_.configure(g.location))};return a}(e.Template);e.Main=f;var m=function(){function b(){b.instance_=b.instance_||new f}b.singleton=function(){return b.instance_};b.prototype.singleton=function(){return b.singleton()};return b}();e.Singleton=m})(b.MODEL||(b.MODEL={}))})(f||(f={}));(function(b){b.Model=b.MODEL.Singleton})(f||(f={}));new (function(){return function(){new f.Model}}())}(window,
window.document,void 0,jQuery);
