koreats

아래 내용이 '/Users/koreats/Desktop/work.mac/hiko0707/docs/supabase-migration-master-plan.md'여기에 반영된게 맞아? 📊 Supabase 마이그레이션 완전성 검토 보고서

  🎯 Executive Summary

  현재 계획을 모두 실행하면 Supabase 19개 테이블 중 **17개(89.5%)**가 활용되며, 프로젝트
  스키마의 **92%**가 Supabase로 마이그레이션됩니다. 2개의 미사용 테이블과 몇 가지 스키마
  불일치를 해결하면 100% 완전한 마이그레이션이 가능합니다.

  ---
  1️⃣ Supabase 테이블 → 프로젝트 매핑 현황

  ✅ 완전 매핑 (11개/19개 = 57.9%)

  | Supabase 테이블            | 프로젝트 스키마              | 상태      |
  |-------------------------|-----------------------|---------|
  | users                   | User                  | ✅ 연결됨   |
  | user_addresses          | Address               | ✅ 연결됨   |
  | hot_deals               | HotDeal               | ✅ 연결됨   |
  | hot_deal_comments       | Comment               | ✅ 연결됨   |
  | proxy_purchases_request | BuyForMeRequest       | ✅ 연결됨   |
  | proxy_purchase_quotes   | BuyForMeRequest.quote | ✅ 연결됨   |
  | payments                | Payment               | ✅ 연결됨   |
  | crawling_logs           | 크롤러 시스템               | ✅ 연결됨   |
  | hot_deal_likes          | User.likedHotdeals    | ✅ 부분 연결 |
  | user_favorite_hotdeals  | 즐겨찾기                  | ✅ 부분 연결 |
  | order_status_history    | 주문 추적                 | ✅ 연결됨   |

  ⚠️ 부분 매핑 (5개/19개 = 26.3%)

  | Supabase 테이블        | 문제점         | 해결 방안           |
  |---------------------|-------------|-----------------|
  | user_profiles       | 중복 존재       | profiles와 통합 필요 |
  | profiles            | User와 부분 중복 | 추가 필드 활용        |
  | admin_activity_logs | 스키마 없음      | 관리자 기능에서 활용     |
  | system_settings     | 스키마 없음      | 설정 관리에 활용       |
  | notifications       | 부분 사용       | 서버 알림으로 확장      |

  ❌ 미사용 (2개/19개 = 10.5%)

  | Supabase 테이블         | 용도     | 활용 계획           |
  |----------------------|--------|-----------------|
  | hotdeal_translations | 다국어 번역 | Phase 5에서 구현 예정 |
  | comment_likes        | 댓글 좋아요 | 관리자 기능에서 구현 예정  |

  ---
  2️⃣ 프로젝트 스키마 → Supabase 매핑 현황

  ✅ 완전 매핑 (11개/12개 = 91.7%)

  - ✅ User, Address, HotDeal, Comment
  - ✅ BuyForMeRequest, Payment, PaymentMethod
  - ✅ Order (부분), Translation (구조 다름)
  - ✅ ShippingInfo, OrderItem (JSONB로 저장)

  ❌ 미매핑 (1개/12개 = 8.3%)

  - ❌ Post: Supabase에 posts 테이블 없음 → 제거 예정

  ---
  3️⃣ LocalStorage → Supabase 대체 현황

  ✅ 이미 대체됨 (12개/19개 = 63.2%)

  ✅ hiko_users → users 테이블
  ✅ hiko_hotdeals → hot_deals 테이블
  ✅ hiko_orders → proxy_purchases_request 테이블
  ✅ hiko_payments → payments 테이블
  ✅ hiko_buyForMeRequests → proxy_purchases_request 테이블
  ✅ hiko_addresses → user_addresses 테이블
  ✅ hiko_favorites → user_favorite_hotdeals 테이블
  ✅ hiko_hotdeal_comments → hot_deal_comments 테이블
  ✅ hiko_payment_requests → quotes 테이블로 통합

  ❌ 미대체 (3개/19개 = 15.8%)

  ❌ hiko_posts → 제거 예정
  ❌ hiko_comments → 제거 예정 (post 관련)
  ❌ hiko_translations → hotdeal_translations로 이동 예정

  ⚠️ 클라이언트 전용 (4개/19개 = 21.0%)

  ⚠️ currentUser → 세션 정보 (유지)
  ⚠️ theme, language → profiles.preferences로 이동 검토
  ⚠️ hiko-filter-presets → 서버 저장 검토
  ⚠️ recentSearches → 클라이언트 유지

  ---
  4️⃣ 주요 Gap 및 해결 방안

  🔧 스키마 불일치 해결

  | 문제                        | 현재 상태            | 해결 방안                   |
  예상 시간 |
  |---------------------------|------------------|-------------------------|-------|
  | clerk_user_id 미사용         | users 테이블 필드 미연결 | Clerk 인증 연동
   | 2시간   |
  | source_id vs sourcePostId | 필드명 불일치          | 매핑 레이어 추가               |
   1시간   |
  | profiles 중복               | 2개 테이블 존재        | 통합 또는 용도 분리
    | 2시간   |
  | 번역 구조 차이                  | 메인 테이블 vs 별도 테이블 | hotdeal_translations
  활용 | 3시간   |

  🎯 미사용 테이블 활용

  1. hotdeal_translations (3시간)
    - 7개 언어 번역 지원
    - 캐싱 및 자동 번역 플래그
    - API 응답 최적화
  2. comment_likes (2시간)
    - 댓글 좋아요 기능
    - like_count 자동 업데이트
    - 중복 좋아요 방지

  🗑️ 불필요 기능 제거

  1. Posts 시스템 (3시간)
    - Post, Comment (post용) 모델 제거
    - recent-posts 컴포넌트 제거
    - 관련 LocalStorage 정리

  ---
  5️⃣ 최종 실행 계획

  Phase 5 보완 (5시간)

  // 1. hotdeal_translations 활용
  - TranslationService Supabase 연동
  - 캐싱 전략 구현 (7일)
  - API 응답 최적화

  // 2. comment_likes 구현  
  - 댓글 좋아요 UI/UX
  - 실시간 카운트 업데이트

  스키마 정합성 (8시간)

  // 1. 필드 매핑 수정
  - TypeScript 인터페이스 업데이트
  - Repository 매핑 레이어
  - 마이그레이션 스크립트

  // 2. Posts 제거
  - 관련 컴포넌트 삭제
  - LocalStorage 키 정리
  - 라우트 제거

  클라이언트 최적화 (5시간)

  // 1. 개인 설정 서버 저장
  - profiles.preferences JSONB 활용
  - theme, language 마이그레이션

  // 2. 클라이언트 전용 유지
  - currentUser (세션)
  - recentSearches (개인정보)

  최종 검증 (3시간)

  - E2E 테스트 실행
  - 성능 벤치마크
  - 보안 감사

  ---
  📈 마이그레이션 완성도

  현재 상태

  - Supabase 테이블 활용률: 17/19 = 89.5%
  - 프로젝트 스키마 매핑률: 11/12 = 91.7%
  - LocalStorage 대체율: 15/19 = 78.9%

  계획 실행 후

  - Supabase 테이블 활용률: 19/19 = 100%
  - 프로젝트 스키마 매핑률: 11/11 = 100% (Post 제거)
  - LocalStorage 대체율: 18/19 = 94.7% (클라이언트 전용 제외)

  총 소요 시간

  - 기존 계획: 43시간
  - 추가 작업: 21시간
  - 전체: 64시간

  이 계획을 실행하면 Supabase 마이그레이션이 완전히 완료되며, 모든 테이블이 활용되고
  불필요한 LocalStorage 의존성이 제거됩니다.
